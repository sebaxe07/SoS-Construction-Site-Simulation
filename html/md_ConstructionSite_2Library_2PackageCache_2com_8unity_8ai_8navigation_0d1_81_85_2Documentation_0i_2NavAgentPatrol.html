<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Making an Agent Patrol Between a Set of Points</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Making an Agent Patrol Between a Set of Points</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md350"></a></p>
<p>Many games feature NPCs that patrol automatically around the playing area. The navigation system can be used to implement this behaviour but it is slightly more involved than standard pathfinding - merely using the shortest path between two points makes for a limited and predictable patrol route. You can get a more convincing patrol pattern by keeping a set of key points that are “useful” for the NPC to pass through and visiting them in some kind of sequence. For example, in a maze, you might place the key patrol points at junctions and corners to ensure the agent checks every corridor. For an office building, the key points might be the individual offices and other rooms.</p>
<p><img src="./Images/NavPatrolMaze.svg" alt="A maze with key patrol points marked" style="pointer-events: none;" class="inline"/></p>
<p>A maze with key patrol points marked</p>
<p>The ideal sequence of patrol points will depend on the way you want the NPCs to behave. For example, a robot would probably just visit the points in a methodical order while a human guard might try to catch the player out by using a more random pattern. The simple behaviour of the robot can be implemented using the code shown below.</p>
<p>The patrol points are supplied to the script using a public array of Transforms. This array can be assigned from the <a href="https://docs.unity3d.com/Manual/UsingTheInspector.html" title="A Unity window that displays information about the currently selected GameObject, asset or project settings, allowing you to inspect and edit the values."><b>inspector</b></a> using <a href="https://docs.unity3d.com/Manual/class-GameObject.html" title="The fundamental object in Unity scenes, which can represent characters, props, scenery, cameras, waypoints, and more. A GameObject’s functionality is defined by the Components attached to it."><b>GameObjects</b></a> to mark the points’ positions. The <em>GotoNextPoint</em> function sets the destination point for the agent (which also starts it moving) and then selects the new destination that will be used on the next call. As it stands, the code cycles through the points in the sequence they occur in the array but you can easily modify this, say by using <a href="https://docs.unity3d.com/ScriptReference/Random.Range.html">Random.Range</a> to choose an array index at random.</p>
<p>In the <em>Update</em> function, the script checks how close the agent is to the destination using the <a href="https://docs.unity3d.com/ScriptReference/AI.NavMeshAgent-remainingDistance.html">remainingDistance</a> property. When this distance is very small, a call to <em>GotoNextPoint</em> is made to start the next leg of the patrol.</p>
<div class="fragment"><div class="line">// Patrol.cs</div>
<div class="line">using UnityEngine;</div>
<div class="line">using UnityEngine.AI;</div>
<div class="line">using System.Collections;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">public class Patrol : MonoBehaviour {</div>
<div class="line"> </div>
<div class="line">    public Transform[] points;</div>
<div class="line">    private int destPoint = 0;</div>
<div class="line">    private NavMeshAgent agent;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    void Start () {</div>
<div class="line">        agent = GetComponent&lt;NavMeshAgent&gt;();</div>
<div class="line"> </div>
<div class="line">        // Disabling auto-braking allows for continuous movement</div>
<div class="line">        // between points (ie, the agent doesn&#39;t slow down as it</div>
<div class="line">        // approaches a destination point).</div>
<div class="line">        agent.autoBraking = false;</div>
<div class="line"> </div>
<div class="line">        GotoNextPoint();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    void GotoNextPoint() {</div>
<div class="line">        // Returns if no points have been set up</div>
<div class="line">        if (points.Length == 0)</div>
<div class="line">            return;</div>
<div class="line"> </div>
<div class="line">        // Set the agent to go to the currently selected destination.</div>
<div class="line">        agent.destination = points[destPoint].position;</div>
<div class="line"> </div>
<div class="line">        // Choose the next point in the array as the destination,</div>
<div class="line">        // cycling to the start if necessary.</div>
<div class="line">        destPoint = (destPoint + 1) % points.Length;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    void Update () {</div>
<div class="line">        // Choose the next destination point when the agent gets</div>
<div class="line">        // close to the current one.</div>
<div class="line">        if (!agent.pathPending &amp;&amp; agent.remainingDistance &lt; 0.5f)</div>
<div class="line">            GotoNextPoint();</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
