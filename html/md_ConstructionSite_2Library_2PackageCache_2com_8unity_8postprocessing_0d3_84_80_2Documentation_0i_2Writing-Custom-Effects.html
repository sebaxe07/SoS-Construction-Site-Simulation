<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Writing custom effects</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Writing custom effects</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md1451"></a></p>
<p>This quick-start guide demonstrates how to write a custom <a href="https://docs.unity3d.com/Manual/PostProcessingOverview.html">post-processing effect</a> and include it in the post-processing stack. This process does not require you to modify the codebase.</p>
<p>Custom post-processing effects require a minimum of two files:</p>
<ul>
<li>A C# source file</li>
<li>An <a href="https://en.wikipedia.org/wiki/High-Level_Shading_Language">HLSL</a> source file</li>
</ul>
<p><a class="el" href="namespaceUnity.html">Unity</a> cross-compiles HLSL to <a href="https://docs.unity3d.com/Manual/SL-GLSLShaderPrograms.html">GLSL</a>, <a href="https://docs.unity3d.com/Manual/Metal.html">Metal</a>, and other APIs. This means it is not restricted to DirectX.</p>
<p>This quick-start guide requires a basic knowledge of programming C# in <a class="el" href="namespaceUnity.html">Unity</a> and HLSL shader programming.</p>
<h1><a class="anchor" id="autotoc_md1452"></a>
C# source code</h1>
<p>The following example demonstrates how to use a C# script to create a custom grayscale post-processing effect. The script in this example calls APIs from the Post Processing framework and works with volume blending. This example is compatible with versions of <a class="el" href="namespaceUnity.html">Unity</a> from 2018 onwards. It is not compatible with <a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.high-definition@latest?subfolder=/manual/">HDRP</a>:</p>
<div class="fragment"><div class="line"><span class="keyword">using </span>System;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespaceUnityEngine.html">UnityEngine</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespaceUnityEngine_1_1Rendering_1_1PostProcessing.html">UnityEngine.Rendering.PostProcessing</a>;</div>
<div class="line"> </div>
<div class="line">[Serializable]</div>
<div class="line">[PostProcess(typeof(GrayscaleRenderer), <a class="code hl_enumeration" href="namespaceUnityEngine_1_1Rendering_1_1PostProcessing.html#a18f9e76659a40e622f8f17b6f609ba89">PostProcessEvent</a>.AfterStack, <span class="stringliteral">&quot;Custom/Grayscale&quot;</span>)]</div>
<div class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class </span>Grayscale : <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessEffectSettings.html">PostProcessEffectSettings</a></div>
<div class="line">{</div>
<div class="line">  [Range(0f, 1f), Tooltip(<span class="stringliteral">&quot;Grayscale effect intensity.&quot;</span>)]</div>
<div class="line">   <span class="keyword">public</span> <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1FloatParameter.html">FloatParameter</a> blend = <span class="keyword">new</span> <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1FloatParameter.html">FloatParameter</a> { value = 0.5f };</div>
<div class="line">}</div>
<div class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class </span>GrayscaleRenderer : PostProcessEffectRenderer&lt;Grayscale&gt;</div>
<div class="line">{</div>
<div class="line">   <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Render(<a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessRenderContext.html">PostProcessRenderContext</a> context)</div>
<div class="line">  {</div>
<div class="line">       var sheet = context.<a class="code hl_property" href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessRenderContext.html#ae08665c530983248dd5db3bc01f776ff">propertySheets</a>.<a class="code hl_function" href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PropertySheetFactory.html#a2a40a2f941484b2f4d09afbaa4a81e1b">Get</a>(Shader.Find(<span class="stringliteral">&quot;Hidden/Custom/Grayscale&quot;</span>));</div>
<div class="line">       sheet.<a class="code hl_property" href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PropertySheet.html#aae00ef7c856ccebb6f65d7ef89edfd6f">properties</a>.SetFloat(<span class="stringliteral">&quot;_Blend&quot;</span>, settings.blend);</div>
<div class="line">       context.<a class="code hl_property" href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessRenderContext.html#a19cc3df17845529e0a6ac560cae54208">command</a>.BlitFullscreenTriangle(context.<a class="code hl_property" href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessRenderContext.html#a0ec42971aeffbf6da0b85067cfa8accf">source</a>, context.<a class="code hl_property" href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessRenderContext.html#ae0265f9484d619c2b02085b0e388541d">destination</a>, sheet, 0);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="aclassUnityEngine_1_1Rendering_1_1PostProcessing_1_1FloatParameter_html"><div class="ttname"><a href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1FloatParameter.html">UnityEngine.Rendering.PostProcessing.FloatParameter</a></div><div class="ttdoc">A ParameterOverride&lt;T&gt; that holds a float value.</div><div class="ttdef"><b>Definition</b> ParameterOverride.cs:194</div></div>
<div class="ttc" id="aclassUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessEffectSettings_html"><div class="ttname"><a href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessEffectSettings.html">UnityEngine.Rendering.PostProcessing.PostProcessEffectSettings</a></div><div class="ttdoc">The base class for all post-processing effect settings. Any ParameterOverride members found in this c...</div><div class="ttdef"><b>Definition</b> PostProcessEffectSettings.cs:32</div></div>
<div class="ttc" id="aclassUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessRenderContext_html"><div class="ttname"><a href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessRenderContext.html">UnityEngine.Rendering.PostProcessing.PostProcessRenderContext</a></div><div class="ttdoc">A context object passed around all post-processing effects in a frame.</div><div class="ttdef"><b>Definition</b> PostProcessRenderContext.cs:13</div></div>
<div class="ttc" id="aclassUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessRenderContext_html_a0ec42971aeffbf6da0b85067cfa8accf"><div class="ttname"><a href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessRenderContext.html#a0ec42971aeffbf6da0b85067cfa8accf">UnityEngine.Rendering.PostProcessing.PostProcessRenderContext.source</a></div><div class="ttdeci">RenderTargetIdentifier source</div><div class="ttdoc">The source target for this pass (can't be the same as destination).</div><div class="ttdef"><b>Definition</b> PostProcessRenderContext.cs:83</div></div>
<div class="ttc" id="aclassUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessRenderContext_html_a19cc3df17845529e0a6ac560cae54208"><div class="ttname"><a href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessRenderContext.html#a19cc3df17845529e0a6ac560cae54208">UnityEngine.Rendering.PostProcessing.PostProcessRenderContext.command</a></div><div class="ttdeci">CommandBuffer command</div><div class="ttdoc">The command buffer to fill render commands in.</div><div class="ttdef"><b>Definition</b> PostProcessRenderContext.cs:78</div></div>
<div class="ttc" id="aclassUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessRenderContext_html_ae0265f9484d619c2b02085b0e388541d"><div class="ttname"><a href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessRenderContext.html#ae0265f9484d619c2b02085b0e388541d">UnityEngine.Rendering.PostProcessing.PostProcessRenderContext.destination</a></div><div class="ttdeci">RenderTargetIdentifier destination</div><div class="ttdoc">The destination target for this pass (can't be the same as source).</div><div class="ttdef"><b>Definition</b> PostProcessRenderContext.cs:88</div></div>
<div class="ttc" id="aclassUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessRenderContext_html_ae08665c530983248dd5db3bc01f776ff"><div class="ttname"><a href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessRenderContext.html#ae08665c530983248dd5db3bc01f776ff">UnityEngine.Rendering.PostProcessing.PostProcessRenderContext.propertySheets</a></div><div class="ttdeci">PropertySheetFactory propertySheets</div><div class="ttdoc">The property sheet factory handled by the currently active PostProcessLayer.</div><div class="ttdef"><b>Definition</b> PostProcessRenderContext.cs:114</div></div>
<div class="ttc" id="aclassUnityEngine_1_1Rendering_1_1PostProcessing_1_1PropertySheetFactory_html_a2a40a2f941484b2f4d09afbaa4a81e1b"><div class="ttname"><a href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PropertySheetFactory.html#a2a40a2f941484b2f4d09afbaa4a81e1b">UnityEngine.Rendering.PostProcessing.PropertySheetFactory.Get</a></div><div class="ttdeci">PropertySheet Get(string shaderName)</div><div class="ttdoc">Gets a PropertySheet for a given shader identifier. Sheets are recycled so you can safely call this m...</div><div class="ttdef"><b>Definition</b> PropertySheetFactory.cs:35</div></div>
<div class="ttc" id="aclassUnityEngine_1_1Rendering_1_1PostProcessing_1_1PropertySheet_html_aae00ef7c856ccebb6f65d7ef89edfd6f"><div class="ttname"><a href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PropertySheet.html#aae00ef7c856ccebb6f65d7ef89edfd6f">UnityEngine.Rendering.PostProcessing.PropertySheet.properties</a></div><div class="ttdeci">MaterialPropertyBlock properties</div><div class="ttdoc">The actual MaterialPropertyBlock to fill.</div><div class="ttdef"><b>Definition</b> PropertySheet.cs:16</div></div>
<div class="ttc" id="anamespaceUnityEngine_1_1Rendering_1_1PostProcessing_html"><div class="ttname"><a href="namespaceUnityEngine_1_1Rendering_1_1PostProcessing.html">UnityEngine.Rendering.PostProcessing</a></div><div class="ttdef"><b>Definition</b> DisplayNameAttribute.cs:4</div></div>
<div class="ttc" id="anamespaceUnityEngine_1_1Rendering_1_1PostProcessing_html_a18f9e76659a40e622f8f17b6f609ba89"><div class="ttname"><a href="namespaceUnityEngine_1_1Rendering_1_1PostProcessing.html#a18f9e76659a40e622f8f17b6f609ba89">UnityEngine.Rendering.PostProcessing.PostProcessEvent</a></div><div class="ttdeci">PostProcessEvent</div><div class="ttdoc">Injection points for custom effects.</div><div class="ttdef"><b>Definition</b> PostProcessEvent.cs:9</div></div>
<div class="ttc" id="anamespaceUnityEngine_html"><div class="ttname"><a href="namespaceUnityEngine.html">UnityEngine</a></div><div class="ttdef"><b>Definition</b> IAnimationPreviewable.cs:4</div></div>
</div><!-- fragment --><blockquote class="doxtable">
<p>&zwj;<b>Important</b>: This file name of this script must match the name of its class for it to serialize correctly. In this case, the script must be stored in a file named <code>Grayscale.cs</code>. </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md1453"></a>
Classes</h2>
<p>A custom post-processing effect script requires two classes:</p>
<ul>
<li>a data class to store settings</li>
<li>a logic class to render the effect</li>
</ul>
<h2><a class="anchor" id="autotoc_md1454"></a>
Data class</h2>
<p>The data class holds all the settings fields the user sees in the Inspector window for that volume profile. Here is how the data class works in the example script described in C# source code:</p>
<div class="fragment"><div class="line"><span class="comment">//The Serializable attribute allows Unity to serialize this class and extend PostProcessEffectSettings.</span></div>
<div class="line">[Serializable]</div>
<div class="line"><span class="comment">// The [PostProcess()] attribute tells Unity that this class holds post-processing data. The first parameter links the settings to a renderer. The second parameter creates the injection point for the effect. The third parameter is the menu entry for the effect. You can use a forward slash (/) to create sub-menu categories.</span></div>
<div class="line">[PostProcess(typeof(GrayscaleRenderer), <a class="code hl_enumeration" href="namespaceUnityEngine_1_1Rendering_1_1PostProcessing.html#a18f9e76659a40e622f8f17b6f609ba89">PostProcessEvent</a>.AfterStack, <span class="stringliteral">&quot;Custom/Grayscale&quot;</span>)]</div>
<div class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class </span>Grayscale : <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessEffectSettings.html">PostProcessEffectSettings</a></div>
<div class="line">{</div>
<div class="line"> <span class="comment">// You can create boxed fields to override or blend parameters. This example uses a FloatParameter with a fixed range from 0 to 1.</span></div>
<div class="line">  [Range(0f, 1f), Tooltip(<span class="stringliteral">&quot;Grayscale effect intensity.&quot;</span>)]</div>
<div class="line">  <span class="keyword">public</span> <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1FloatParameter.html">FloatParameter</a> blend = <span class="keyword">new</span> <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1FloatParameter.html">FloatParameter</a> { value = 0.5f };</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md1455"></a>
Notes:</h3>
<p>The second parameter of the <code>[PostProcess()]</code> attribute is the injection point for the effect. There are three injection points available:</p>
<ul>
<li><code>BeforeTransparent</code>: <a class="el" href="namespaceUnity.html">Unity</a> only applies the effect to opaque objects before <a class="el" href="namespaceUnity.html">Unity</a> runs the transparent pass.</li>
<li><code>BeforeStack</code>: <a class="el" href="namespaceUnity.html">Unity</a> injects the effect before applying the built-in stack. This applies to all post processing effects except <a href="https://docs.unity3d.com/Packages/com.unity.postprocessing@latest?subfolder=/manual/Anti-aliasing.html">Temporal anti-aliasing (TAA),</a> which <a class="el" href="namespaceUnity.html">Unity</a> applies before any injection points.</li>
<li><code>AfterStack</code>: <a class="el" href="namespaceUnity.html">Unity</a> applies the effect after the built-in stack and before <a href="https://docs.unity3d.com/Packages/com.unity.postprocessing@latest?subfolder=/manual/Anti-aliasing#fast-approximate-anti-aliasing.html">FXAA</a> (if it's enabled) and final-pass dithering.</li>
</ul>
<p>The <code>[PostProcess()]</code> attribute has an optional fourth parameter called <code>allowInSceneView</code>. You can use this parameter to enable or disable the effect in the scene. It's set to true by default, but you can disable it for temporal effects or effects that get in the way of editing the scene easily.</p>
<p>For a full list of built-in parameter classes, see the <code>ParameterOverride.cs</code> source file in **/PostProcessing/Runtime/**.</p>
<p>If you want to set your own requirements for the effect or disable it until a condition is met, you can override the <code>IsEnabledAndSupported()</code> method of <code>PostProcessEffectSettings</code>. For example, the following script automatically disables an effect if the blend parameter is <code>0</code>:</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">bool</span> IsEnabledAndSupported(<a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessRenderContext.html">PostProcessRenderContext</a> context)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> enabled.value</div>
<div class="line">        &amp;&amp; blend.value &gt; 0f;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1456"></a>
Logic class</h2>
<p>The logic class tells <a class="el" href="namespaceUnity.html">Unity</a> how to render this post-processing effect. Here is how the logic class works in the example script described in C# source code:</p>
<div class="fragment"><div class="line"><span class="comment">// This renderer extends PostProcessEffectRenderer&lt;T&gt;, where T is the settings type Unity attaches to this renderer.</span></div>
<div class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class </span>GrayscaleRenderer : PostProcessEffectRenderer&lt;Grayscale&gt;</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Everything that happens in the Render() method takes a PostProcessRenderContext as parameter.</span></div>
<div class="line"> <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Render(<a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessRenderContext.html">PostProcessRenderContext</a> context)</div>
<div class="line">  {</div>
<div class="line"><span class="comment">// Request a PropertySheet for our shader and set the uniform within it.</span></div>
<div class="line">       var sheet = context.<a class="code hl_property" href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessRenderContext.html#ae08665c530983248dd5db3bc01f776ff">propertySheets</a>.<a class="code hl_function" href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PropertySheetFactory.html#a2a40a2f941484b2f4d09afbaa4a81e1b">Get</a>(Shader.Find(<span class="stringliteral">&quot;Hidden/Custom/Grayscale&quot;</span>));</div>
<div class="line"><span class="comment">// Send the blend parameter value to the shader.</span></div>
<div class="line">       sheet.<a class="code hl_property" href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PropertySheet.html#aae00ef7c856ccebb6f65d7ef89edfd6f">properties</a>.SetFloat(<span class="stringliteral">&quot;_Blend&quot;</span>, settings.blend);</div>
<div class="line"> <span class="comment">// This context provides a command buffer which you can use to blit a fullscreen pass using a source image as an input with a destination for the shader, sheet and pass number.</span></div>
<div class="line">      context.<a class="code hl_property" href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessRenderContext.html#a19cc3df17845529e0a6ac560cae54208">command</a>.BlitFullscreenTriangle(context.<a class="code hl_property" href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessRenderContext.html#a0ec42971aeffbf6da0b85067cfa8accf">source</a>, context.<a class="code hl_property" href="classUnityEngine_1_1Rendering_1_1PostProcessing_1_1PostProcessRenderContext.html#ae0265f9484d619c2b02085b0e388541d">destination</a>, sheet, 0);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md1457"></a>
Notes:</h3>
<p>The <code>PostProcessRenderContext</code> context holds data that <a class="el" href="namespaceUnity.html">Unity</a> passes around effects when it renders them. You can find out what data is available in **/PostProcessing/Runtime/PostProcessRenderContext.cs**.</p>
<p>The example grayscale effect script only uses <a href="https://docs.unity3d.com/ScriptReference/Rendering.CommandBuffer.html">command buffers</a> which means the system relies on <code>MaterialPropertyBlock</code> to store shader data. Unity’s framework automatically pools the shader data to save time and optimize performance. This script requests a <code>PropertySheet</code> for the shader and sets the uniform inside it, so that you do not need to create <code>MaterialPropertyBlock</code> manually.</p>
<p><code>PostProcessEffectRenderer&lt;T&gt;</code> has the following methods you can override:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Method   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>void Init()</code>   </td><td class="markdownTableBodyNone">This method is called when the renderer is created    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>DepthTextureMode GetLegacyCameraFlags()</code>   </td><td class="markdownTableBodyNone">This method sets Camera flags and requests depth maps, motion vectors, etc.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>void ResetHistory()</code>   </td><td class="markdownTableBodyNone">This method is called when a "reset history" event is dispatched. Use this to clear history buffers for temporal effects.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>void Release()</code>   </td><td class="markdownTableBodyNone">This method is called when the renderer is destroyed. You can perform a cleanup here   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md1458"></a>
HLSL source code</h1>
<p><a class="el" href="namespaceUnity.html">Unity</a> uses the HLSL programming language for shader programs. For more information, see <a href="https://docs.unity3d.com/Manual/SL-ShadingLanguage.html">Shading language used in Unity</a>.</p>
<p>The following example demonstrates how to create an HLSL script for a custom grayscale post-processing effect:</p>
<div class="fragment"><div class="line">Shader &quot;Hidden/Custom/Grayscale&quot;</div>
<div class="line">{</div>
<div class="line">  HLSLINCLUDE</div>
<div class="line">// StdLib.hlsl holds pre-configured vertex shaders (VertDefault), varying structs (VaryingsDefault), and most of the data you need to write common effects.</div>
<div class="line">      #include &quot;Packages/com.unity.postprocessing/PostProcessing/Shaders/StdLib.hlsl&quot;</div>
<div class="line">      TEXTURE2D_SAMPLER2D(_MainTex, sampler_MainTex);</div>
<div class="line">// Lerp the pixel color with the luminance using the _Blend uniform.</div>
<div class="line">      float _Blend;</div>
<div class="line">      float4 Frag(VaryingsDefault i) : SV_Target</div>
<div class="line">      {</div>
<div class="line">          float4 color = SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, i.texcoord);</div>
<div class="line">// Compute the luminance for the current pixel</div>
<div class="line">          float luminance = dot(color.rgb, float3(0.2126729, 0.7151522, 0.0721750));</div>
<div class="line">          color.rgb = lerp(color.rgb, luminance.xxx, _Blend.xxx);</div>
<div class="line">// Return the result</div>
<div class="line">          return color;</div>
<div class="line">      }</div>
<div class="line">  ENDHLSL</div>
<div class="line">  SubShader</div>
<div class="line">  {</div>
<div class="line">      Cull Off ZWrite Off ZTest Always</div>
<div class="line">      Pass</div>
<div class="line">      {</div>
<div class="line">          HLSLPROGRAM</div>
<div class="line">              #pragma vertex VertDefault</div>
<div class="line">              #pragma fragment Frag</div>
<div class="line">          ENDHLSL</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md1459"></a>
Notes:</h3>
<p>This framework uses <a href="https://docs.unity3d.com/Manual/SL-BuiltinMacros.html">shader preprocessor macros</a> to define platform differences. This helps to maintain compatibility across platforms and render pipelines.</p>
<p>This script also uses macros to declare textures. For a list of available macros, see the API files in **/PostProcessing/Shaders/API/**.</p>
<p>This script uses HLSL blocks instead of CG blocks to avoid compatibility issues between render pipelines. Inside the HLSL block is the varying structs parameter, <code>VaryingsDefault i</code>. This parameter can use the following variables: </p><div class="fragment"><div class="line">struct VaryingsDefault</div>
<div class="line">{</div>
<div class="line">   float4 vertex : SV_POSITION;</div>
<div class="line">   float2 texcoord : TEXCOORD0;</div>
<div class="line">   float2 texcoordStereo : TEXCOORD1;</div>
<div class="line">#if STEREO_INSTANCING_ENABLED</div>
<div class="line">   uint stereoTargetEyeIndex : SV_RenderTargetArrayIndex;</div>
<div class="line">#endif</div>
<div class="line">};</div>
</div><!-- fragment --><ul>
<li><code>vertex</code>: The vertex position.</li>
<li><code>texcoord</code>: The UV coordinate for the fragment.</li>
<li><code>texcoordStereo</code>: The UV coordinate for the fragment in stereo mode</li>
<li><code>stereoTargetEyeIndex</code>: The current eye index (only available with VR + stereo instancing).</li>
</ul>
<p><a class="el" href="namespaceUnity.html">Unity</a> cannot build a shader if it is not referenced in a scene. This means the effect does not work when the application is running outside of the Editor. To fix this, add your shader to a<a href="https://docs.unity3d.com/Manual/LoadingResourcesatRuntime.html">Resources folder</a> or include it in the <a href="https://docs.unity3d.com/Manual/class-GraphicsSettings.html#Always"><b>Always Included Shaders</b></a> list in <b>Edit &gt; Project Settings &gt; <a class="el" href="namespaceGraphics.html">Graphics</a></b>.</p>
<h1><a class="anchor" id="autotoc_md1460"></a>
Ordering post-processing effects</h1>
<p><a class="el" href="namespaceUnity.html">Unity</a> automatically sorts built-in effects, but it handles custom effects differently. When you create a new effect or import it into your project, <a class="el" href="namespaceUnity.html">Unity</a> does the following:</p>
<ul>
<li>Adds the custom effect to the Custom Effect Sorting list in the Post Process Layer component on a Camera.</li>
<li>Sorts each custom effect by its injection point. You can change the order of the custom effects in the Post Process Layer component using <b>Custom Effect Sorting</b>.</li>
</ul>
<p><a class="el" href="namespaceUnity.html">Unity</a> orders custom effects within each layer, which means you can order your custom effects differently for each Camera.</p>
<h1><a class="anchor" id="autotoc_md1461"></a>
Creating a custom editor</h1>
<p><a class="el" href="namespaceUnity.html">Unity</a> automatically creates editors for settings classes. If you want to control how <a class="el" href="namespaceUnity.html">Unity</a> displays certain fields, you can create a custom editor.</p>
<p>The following example uses the default editor script to create a custom editor for a <code>Grayscale</code> effect:</p>
<div class="fragment"><div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespaceUnityEngine_1_1Rendering_1_1PostProcessing.html">UnityEngine.Rendering.PostProcessing</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespaceUnityEditor_1_1Rendering_1_1PostProcessing.html">UnityEditor.Rendering.PostProcessing</a>;</div>
<div class="line"> </div>
<div class="line">[PostProcessEditor(typeof(Grayscale))]</div>
<div class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class </span>GrayscaleEditor : <a class="code hl_class" href="classUnityEditor_1_1Rendering_1_1PostProcessing_1_1PostProcessEffectEditor.html">PostProcessEffectEditor</a>&lt;Grayscale&gt;</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_class" href="classUnityEditor_1_1Rendering_1_1PostProcessing_1_1SerializedParameterOverride.html">SerializedParameterOverride</a> m_Blend;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> OnEnable()</div>
<div class="line">    {</div>
<div class="line">        m_Blend = FindParameterOverride(x =&gt; x.blend);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> OnInspectorGUI()</div>
<div class="line">    {</div>
<div class="line">        PropertyField(m_Blend);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassUnityEditor_1_1Rendering_1_1PostProcessing_1_1PostProcessEffectEditor_html"><div class="ttname"><a href="classUnityEditor_1_1Rendering_1_1PostProcessing_1_1PostProcessEffectEditor.html">UnityEditor.Rendering.PostProcessing.PostProcessEffectEditor</a></div><div class="ttdoc">The class to inherit from when designing custom effect editors.</div><div class="ttdef"><b>Definition</b> PostProcessEffectEditor.cs:13</div></div>
<div class="ttc" id="aclassUnityEditor_1_1Rendering_1_1PostProcessing_1_1SerializedParameterOverride_html"><div class="ttname"><a href="classUnityEditor_1_1Rendering_1_1PostProcessing_1_1SerializedParameterOverride.html">UnityEditor.Rendering.PostProcessing.SerializedParameterOverride</a></div><div class="ttdoc">A wrapper used for ParameterOverride&lt;T&gt; serialization and easy access to the underlying property and ...</div><div class="ttdef"><b>Definition</b> SerializedParameterOverride.cs:12</div></div>
<div class="ttc" id="anamespaceUnityEditor_1_1Rendering_1_1PostProcessing_html"><div class="ttname"><a href="namespaceUnityEditor_1_1Rendering_1_1PostProcessing.html">UnityEditor.Rendering.PostProcessing</a></div><div class="ttdef"><b>Definition</b> DecoratorAttribute.cs:4</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md1462"></a>
Notes:</h3>
<p>For <a class="el" href="namespaceUnity.html">Unity</a> to recognise your custom editor, it has to be in an Editor folder.</p>
<h1><a class="anchor" id="autotoc_md1463"></a>
FXAA compatibility with custom effects</h1>
<p>If you apply <a href="Anti-aliasing#fast-approximate-anti-aliasing.html"><b>FXAA</b></a> in a scene with custom effects, the order of your post-processing effects might stop it from working correctly. This is because FXAA looks for the LDR (Low dynamic range) luminance value of each pixel in the alpha channel of its source target to optimise performance.</p>
<p>If you inject custom effects at the <code>AfterStack</code> injection point, as demonstrated in the example above, FXAA looks for LDR luminance in the last executed effect. If it can’t find it, FXAA won’t work correctly.</p>
<p>You can fix this in your custom shader in one of two ways:</p>
<ul>
<li>Make sure that the last executed effect contains LDR luminance in the alpha channel.</li>
<li>Copy the alpha from the incoming source. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
