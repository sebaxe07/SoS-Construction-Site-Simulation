<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Deferred Rendering Path in URP</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Deferred Rendering Path in URP</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md2344"></a></p>
<p>URP Universal Renderer supports the following Rendering Paths:</p>
<ul>
<li>Forward</li>
<li>Forward+</li>
<li>Deferred</li>
</ul>
<p>For information on differences between the rendering paths, refer to <a href="../urp-universal-renderer.md#rendering-path-comparison">Rendering Path comparison</a>.</p>
<p>This section describes the Deferred Rendering Path.</p>
<p><img src="../Images/rendering-deferred/deferred-intro-image.png" alt="Scene rendered with the Deferred Rendering Path" class="inline"/><br  />
<em><a class="el" href="classSample.html">Sample</a> Scene rendered with the Deferred Rendering Path.</em></p>
<p>This section contains the following topics:</p>
<ul>
<li>How to select the Deferred Rendering Path</li>
<li>Unity Player system requirements</li>
<li>Implementation details</li>
<li>Relevant code files</li>
<li>ShaderLab Pass tags</li>
<li>Limitations and performance</li>
</ul>
<h1><a class="anchor" id="autotoc_md2345"></a>
<a class="anchor" id="how-to-enable"></a>How to select the Deferred Rendering Path</h1>
<p>To select the Rendering Path, use the property <b>Lighting</b> &gt; <b>Rendering Path</b> in the URP Universal Renderer asset.</p>
<p><img src="../Images/rendering-deferred/urp-renderer-select-deferred-path.png" alt="Select the Rendering Path in the URP Universal Renderer asset" class="inline"/></p>
<p>When you select the Deferred Rendering Path, <a class="el" href="namespaceUnity.html">Unity</a> shows the Accurate G-buffer normals property.</p>
<p>The <b>Accurate G-buffer normals</b> property lets you configure how <a class="el" href="namespaceUnity.html">Unity</a> encodes the normals when storing them in the geometry buffer (G-buffer).</p>
<ul>
<li><b>Accurate G-buffer normals</b> off: This option increases performance, especially on mobile GPUs, but might lead to color banding artifacts on smooth surfaces.</li>
<li><b>Accurate G-buffer normals</b> on: <a class="el" href="namespaceUnity.html">Unity</a> uses the octahedron encoding to store values of normal vectors in the RGB channel of a normal texture. With this encoding, values of normal vectors are more accurate, but the encoding and decoding operations put extra load on the GPU. This option does not support decal normal blending when used with the <a href="../renderer-feature-decal.md#screen-space-technique">Screen Space decal technique</a>.</li>
</ul>
<p>For more information about this setting, refer to the section Encoding of normals in G-buffer.</p>
<h1><a class="anchor" id="autotoc_md2346"></a>
<a class="anchor" id="requirements"></a>Unity Player system requirements</h1>
<p>The Deferred Rendering Path has the following requirements and limitations on top of the general system requirements for the <a class="el" href="namespaceUnity.html">Unity</a> Player.</p>
<ul>
<li>Minimum Shader Model: Shader Model 4.5.</li>
<li>Deferred Rendering Path does not support the OpenGL and OpenGL ES API.<br  />
If a project with the Deferred Rendering Path is built for platforms using those API, the application falls back to the Forward Rendering Path.</li>
</ul>
<h1><a class="anchor" id="autotoc_md2347"></a>
Implementation details</h1>
<p>This section describes the implementation details of this feature, and technical details about how this feature functions.</p>
<h2><a class="anchor" id="autotoc_md2348"></a>
G-buffer layout</h2>
<p>This section describes how <a class="el" href="namespaceUnity.html">Unity</a> stores material attributes in the G-buffer in the Deferred Rendering Path.</p>
<p>The following illustration shows the data structure for each pixel of the render targets that <a class="el" href="namespaceUnity.html">Unity</a> uses in the Deferred Rendering Path.</p>
<p><img src="../Images/rendering-deferred/data-structure-render-targets-g-buffer.png" alt="Data structure of the render targets that Unity uses in the Deferred Rendering Path" class="inline"/></p>
<p>The data structure consists of the following components.</p>
<p><b>Albedo (sRGB)</b></p>
<p>This field contains the albedo color in sRGB format, 24 bits.</p>
<p><b>MaterialFlags</b></p>
<p>This field is a bit field that contains Material flags:</p>
<ul>
<li>Bit 0, <b>ReceiveShadowsOff</b>: if set, the pixel does not receive dynamic shadows.</li>
<li>Bit 1, <b>SpecularHighlightsOff</b>: if set, the pixel does not receive specular highlights.</li>
<li>Bit 2, <b>SubtractiveMixedLighting</b>: if set, the pixel uses subtractive mixed lighting.</li>
<li>Bit 3, <b>SpecularSetup</b>: if set, the Material uses the specular workflow.</li>
</ul>
<p>Bits 4-7 are reserved for future use.</p>
<p>For more technical details, refer to the file <code>/ShaderLibrary/UnityGBuffer.hlsl</code>.</p>
<p><b>Specular</b></p>
<p>This field contains the following values:</p>
<ul>
<li>SimpleLit Material: RGB specular color stored in 24 bits.</li>
<li>Lit Material with metallic workflow: reflectivity stored in 8 bits, 16 bits are not used.</li>
<li>Lit Material with specular workflow: RGB specular color stored in 24 bits.</li>
</ul>
<p><b>Occlusion</b></p>
<p>This field contains the baked occlusion value from the baked lighting. For real-time lighting, <a class="el" href="namespaceUnity.html">Unity</a> calculates the ambient occlusion value by combining the baked occlusion value with the SSAO value.</p>
<p><b>Normal</b></p>
<p>This field contains the world space normals encoded in 24 bits. For information on the encoding of normals, refer to Encoding of normals in G-buffer.</p>
<p><b>Smoothness</b></p>
<p>This field stores the smoothness value for the SimpleLit and Lit materials.</p>
<p><b>Emissive/GI/Lighting</b></p>
<p>This render target contains the Material emissive output and baked lighting. <a class="el" href="namespaceUnity.html">Unity</a> fills this field during the G-buffer Pass. During the deferred shading pass, <a class="el" href="namespaceUnity.html">Unity</a> stores lighting results in this render target.</p>
<p>Render target format:</p>
<ul>
<li><b>B10G11R11_UFloatPack32</b>, unless one of the following conditions is true:<ul>
<li>In URP Asset, the setting <b>Quality</b> &gt; <b>HDR</b> is turned on, and the target Player platform does not support HDR.</li>
<li>In Player Settings, the setting <b>PreserveFramebufferAlpha</b> is true.</li>
</ul>
</li>
<li><b>R16G6B16A16_SFloat</b>, if <a class="el" href="namespaceUnity.html">Unity</a> cannot use <b>B10G11R11_UFloatPack32</b> because of the project settings.</li>
<li>If <a class="el" href="namespaceUnity.html">Unity</a> cannot use one of the other formats in the list, it uses what the following method returns: <code>SystemInfo.GetGraphicsFormat(DefaultFormat.HDR)</code>.</li>
</ul>
<p><b>ShadowMask</b></p>
<p><a class="el" href="namespaceUnity.html">Unity</a> adds this render target to the G-buffer layout when Lighting Mode is set to Subtractive or Shadow mask.</p>
<p>The Subtractive and the Shadow mask modes are optimized for the Forward Rendering Path, and are less efficient in the Deferred Rendering Path. In the Deferred Rendering Path, avoid using these modes and use the Baked Indirect mode instead to improve GPU performance.</p>
<p><b>Rendering Layer Mask</b></p>
<p><a class="el" href="namespaceUnity.html">Unity</a> adds this render target to the G-buffer layout when the Use Rendering Layers option is enabled (URP Asset, <b>Lighting</b> &gt; <b>Use Rendering Layers</b>).</p>
<p>Using Rendering Layers might have an impact on the GPU performance. For more information, refer to the page <a href="../features/rendering-layers.md#performance">Rendering Layers</a>.</p>
<p><b>Depth as Color</b></p>
<p><a class="el" href="namespaceUnity.html">Unity</a> adds this render target to the G-buffer layout when Native Render Pass is enabled on platforms that support it. <a class="el" href="namespaceUnity.html">Unity</a> renders depth as a color into this render target. This render target has the following purpose:</p>
<ul>
<li>Improves performance on Vulkan devices.</li>
<li>Lets <a class="el" href="namespaceUnity.html">Unity</a> get the depth buffer on Metal API, which does not allow fetching the depth from the DepthStencil buffer within the same render pass.</li>
</ul>
<p>The format of the Depth as Color render target is <code>GraphicsFormat.R32_SFloat</code>.</p>
<p><b>DepthStencil</b></p>
<p><a class="el" href="namespaceUnity.html">Unity</a> reserves the four highest bits of this render target to mark the Material type. For more information, refer to <a href="../urp-shaders/urp-shaderlab-pass-tags.md#universalmaterialtype">URP Pass tags: UniversalMaterialType</a>.</p>
<p>For this render target, <a class="el" href="namespaceUnity.html">Unity</a> selects either the <code>D32F_S8</code> format, or the <code>D24S8</code> format depending on the platform.</p>
<h2><a class="anchor" id="autotoc_md2349"></a>
<a class="anchor" id="accurate-g-buffer-normals"></a>Encoding of normals in G-buffer</h2>
<p>In the Deferred Rendering Path, <a class="el" href="namespaceUnity.html">Unity</a> stores normals in the G-buffer. <a class="el" href="namespaceUnity.html">Unity</a> encodes each normal as a 24 bit value.</p>
<p>When you select the <b>Deferred</b> option in the <b>Rendering Path</b> property in the URP Universal Renderer asset, <a class="el" href="namespaceUnity.html">Unity</a> shows the <b>Accurate G-buffer normals</b> property.</p>
<p><img src="../Images/rendering-deferred/urp-renderer-accurate-g-buffer-normals.png" alt="The Accurate G-buffer normals property in the URP Universal Renderer asset" class="inline"/></p>
<p>The <b>Accurate G-buffer normals</b> property lets you configure how <a class="el" href="namespaceUnity.html">Unity</a> encodes the normals.</p>
<ul>
<li><b>Accurate G-buffer normals</b> off: <a class="el" href="namespaceUnity.html">Unity</a> stores values of normal vectors in the G-buffer in the RGB channel of a normal texture, 8 bit per value (x, y, z). The values are quantized with the loss of accuracy. This option increases performance, especially on mobile GPUs, but might lead to color banding artifacts on smooth surfaces.</li>
<li><b>Accurate G-buffer normals</b> on: <a class="el" href="namespaceUnity.html">Unity</a> uses the octahedron encoding to store values of normal vectors in the RGB channel of a normal texture. With this encoding, values of normal vectors are more accurate, but the encoding and decoding operations put extra load on the GPU. This option does not support decal normal blending when used with the <a href="../renderer-feature-decal.md#screen-space-technique">Screen Space decal technique</a>.<br  />
The precision of the encoded normal vectors is similar to the precision of the sampled values in the Forward Rendering Path.</li>
</ul>
<p>The following illustration shows the visual difference between the two options when the Camera is very close to the GameObject:</p>
<p><img src="../Images/rendering-deferred/difference-accurate-g-buffer-normals-on-off.png" alt="Accurate G-buffer normals, visual difference between the two options." class="inline"/></p>
<p><b>Performance considerations</b></p>
<p>With <b>Accurate G-buffer normals</b> option turned on, there is extra load on the GPU because of the encoding and decoding operations. This load is insignificant for desktop platforms and consoles, but might be considerable for mobile GPUs.</p>
<p>Turning the option on does not increase the memory footprint. To store the normals, <a class="el" href="namespaceUnity.html">Unity</a> uses the same RGB channel in the normal texture regardless of the encoding.</p>
<h2><a class="anchor" id="autotoc_md2350"></a>
<a class="anchor" id="render-passes"></a>Deferred Rendering Path render Passes</h2>
<p>The following table shows the sequence of Render Pass events in the Deferred Rendering Path.</p>
<table class="doxtable">
<tr>
<th>Render Pass events </th><th>Deferred Rendering Path Passes </th><th>SSAO Renderer Feature Passes    </th></tr>
<tr>
<td>BeforeRendering </td><td>&amp;#160; </td><td>&amp;#160;  </td></tr>
<tr>
<td>BeforeRenderingShadows </td><td>&amp;#160; </td><td>&amp;#160;  </td></tr>
<tr>
<td>AfterRenderingShadows </td><td>&amp;#160; </td><td>&amp;#160;  </td></tr>
<tr>
<td>BeforeRenderingPrePasses </td><td>Depth, or depth and normal prepass (Forward only materials) </td><td>&amp;#160;  </td></tr>
<tr>
<td>AfterRenderingPrePasses </td><td>&amp;#160; </td><td>&amp;#160;  </td></tr>
<tr>
<td>BeforeRenderingGbuffer </td><td>G-buffer Pass (GBufferPass) </td><td>&amp;#160;  </td></tr>
<tr>
<td>&amp;#160; </td><td>Copy G-buffer depth texture </td><td>&amp;#160;  </td></tr>
<tr>
<td>AfterRenderingGbuffer </td><td>&amp;#160; </td><td>SSAO (optional)  </td></tr>
<tr>
<td>BeforeRenderingDeferredLights </td><td>&amp;#160; </td><td rowspan="4"><img src="../Images/rendering-deferred/decorator-or.png" alt="" class="inline"/>  </td></tr>
<tr>
<td></td><td>Deferred rendering (stencil)  </td></tr>
<tr>
<td>AfterRenderingDeferredLights </td><td>&amp;#160;  </td></tr>
<tr>
<td>BeforeRenderingOpaques </td><td>Opaque Forward-only Materials  </td></tr>
<tr>
<td>AfterRenderingOpaques </td><td>&amp;#160; </td><td>SSAO and blending (optional)  </td></tr>
<tr>
<td>BeforeRenderingSkybox </td><td>&amp;#160; </td><td>&amp;#160;  </td></tr>
<tr>
<td>AfterRenderingSkybox </td><td>&amp;#160; </td><td>&amp;#160;  </td></tr>
<tr>
<td>BeforeRenderingTransparents </td><td>&amp;#160; </td><td>&amp;#160;  </td></tr>
<tr>
<td>AfterRenderingTransparents </td><td>&amp;#160; </td><td>&amp;#160;  </td></tr>
<tr>
<td>BeforeRenderingPostProcessing </td><td>&amp;#160; </td><td>&amp;#160;  </td></tr>
<tr>
<td>AfterRenderingPostProcessing </td><td>&amp;#160; </td><td>&amp;#160;  </td></tr>
<tr>
<td>AfterRendering </td><td>&amp;#160; </td><td>&amp;#160;   </td></tr>
</table>
<p>The following sections describe the Deferred Rendering Path render Passes.</p>
<h3><a class="anchor" id="autotoc_md2351"></a>
Depth, or depth and normal prepass</h3>
<p>In the Deferred Rendering Path, in the depth prepass or depth and normal prepass, <a class="el" href="namespaceUnity.html">Unity</a> renders only the Materials that do not support the deferred rendering model. For example, Materials using the Complex Lit shader are such Materials.</p>
<p>In the Deferred Rendering Path, <a class="el" href="namespaceUnity.html">Unity</a> does not use the depth prepass to generate a copy of the depth buffer (this behavior is different in the Forward Rendering Path).</p>
<p>If the Universal Renderer has the SSAO Renderer Feature, <a class="el" href="namespaceUnity.html">Unity</a> executes the depth and normal prepass. SSAO uses the screen-space depth and normal buffers to calculate ambient occlusion.</p>
<h3><a class="anchor" id="autotoc_md2352"></a>
Optional passes: SSAO, SSAO with blending</h3>
<p>If the Universal Renderer has the SSAO Renderer Feature, and the <b>After Opaque</b> option is disabled (the option is disabled by default), <a class="el" href="namespaceUnity.html">Unity</a> executes the SSAO Pass at the AfterRenderingGbuffer event. The SSAO Renderer Feature calculates the SSAO texture. <a class="el" href="namespaceUnity.html">Unity</a> samples this texture in the Deferred rendering Pass and in the Pass that renders Forward-only Materials.</p>
<p>Using this Pass order, <a class="el" href="namespaceUnity.html">Unity</a> can combine the baked occlusion with the real-time occlusion from the SSAO Renderer Feature, and avoid double-darkening from the baked and the real-time ambient occlusion.</p>
<p>When the After Opaque option is enabled, <a class="el" href="namespaceUnity.html">Unity</a> executes the SSAO and blending Pass at the AfterRenderingOpaques event, after rendering the Forward-only Materials. <a class="el" href="namespaceUnity.html">Unity</a> then executes an extra full screen Pass to overlay the SSAO texture onto the Emissive/GI/Lighting buffer. This causes over-darkening of the areas that receive baked occlusion and real-time occlusion.</p>
<p><b>Performance considerations</b></p>
<p>On mobile platforms with TBDR architecture, with the <b>After Opaque</b> option is disabled, <a class="el" href="namespaceUnity.html">Unity</a> requires an extra render target for load and store operations. This has a significant performance impact.</p>
<p>Enabling the <b>After Opaque</b> option on mobile platforms improves GPU performance. On mobile platforms with TBDR architecture, enabling this option avoids extra render target load and store operations.</p>
<h3><a class="anchor" id="autotoc_md2353"></a>
Forward-only Pass</h3>
<p>Certain <a class="el" href="namespaceUnity.html">Unity</a> shaders use lighting models that <a class="el" href="namespaceUnity.html">Unity</a> cannot render in the Deferred Rendering Path.</p>
<p>Examples of such shaders:</p>
<ul>
<li><b>Complex Lit</b>: the Lighting model of this shader (for example, the Clear Coat effect) is too complex and extra Material properties cannot fit into the G-buffer.</li>
<li><b>Baked Lit</b> and <b>Unlit</b>: these shaders do not calculate real-time lighting, that's why <a class="el" href="namespaceUnity.html">Unity</a> renders them into the Emissive/GI/Lighting buffer directly during the Forward-only pass. This is faster than evaluating the shaders in the Deferred rendering (stencil) pass.</li>
<li><b>Custom shaders</b>: <a class="el" href="namespaceUnity.html">Unity</a> renders the shaders that do not declare the Pass tags required by the Deferred Rendering Path as Forward-only. The required Pass tags are: <code>LightMode</code>, and <code>UniversalMaterialType</code>. For more information, refer to <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8render-pipelines_8universal_0d14_80_811_533dd7cdc58857cbfbc5d3c930cbfae5.html">URP Pass tags</a>.</li>
</ul>
<p><a class="el" href="namespaceUnity.html">Unity</a> renders Materials with such shaders in the Forward Rendering Path. For the SSAO Renderer Feature to be able to calculate ambient occlusion for the Materials using the <b>Complex Lit</b> shader, <a class="el" href="namespaceUnity.html">Unity</a> must render such Materials in the depth and normal prepass first. This is because <a class="el" href="namespaceUnity.html">Unity</a> does not render those Materials in the G-buffer pass (GBufferPass). For more information, refer to <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8render-pipelines_8universal_0d14_80_811_533dd7cdc58857cbfbc5d3c930cbfae5.html">URP Pass tags</a>.</p>
<h3><a class="anchor" id="autotoc_md2354"></a>
General implementation notes</h3>
<p>For maximum platform compatibility, the URP Deferred Rendering Path uses the light stencil volume technique to render light volumes and apply deferred shading.</p>
<h1><a class="anchor" id="autotoc_md2355"></a>
Relevant code files</h1>
<p>This section contains the list of files that contain the code related to the Deferred Rendering Path.</p>
<ul>
<li><p class="startli">The main class that handles the Deferred Rendering Path:</p>
<div class="fragment"><div class="line">com.unity.render-pipelines.universal\Runtime\DeferredLights.cs</div>
</div><!-- fragment --></li>
<li><p class="startli">ScriptableRenderPass for the G-Buffer pass:</p>
<div class="fragment"><div class="line">com.unity.render-pipelines.universal\Runtime\Passes\GBufferPass.cs</div>
</div><!-- fragment --></li>
<li><p class="startli">ScriptableRenderPass for the deferred shading pass:</p>
<div class="fragment"><div class="line">com.unity.render-pipelines.universal\Runtime\Passes\DeferredPass.cs</div>
</div><!-- fragment --></li>
<li><p class="startli">Shader asset for the deferred shading:</p>
<div class="fragment"><div class="line">com.unity.render-pipelines.universal\Shaders\Utils\StencilDeferred.shader</div>
</div><!-- fragment --></li>
<li><p class="startli">Utility functions for the deferred shading:</p>
<div class="fragment"><div class="line">com.unity.render-pipelines.universal\Shaders\Utils\Deferred.hlsl</div>
</div><!-- fragment --></li>
<li><p class="startli">Utility functions for storing and loading the Material properties from the G-buffer:</p>
<div class="fragment"><div class="line">com.unity.render-pipelines.universal\Shaders\Utils\UnityGBuffer.hlsl</div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="autotoc_md2356"></a>
ShaderLab Pass tags</h1>
<p>To enable <a class="el" href="namespaceUnity.html">Unity</a> to render a shader in the Deferred Rendering Path, the shader must have a Pass with the following tag definition:</p>
<p><code>"LightMode" = "UniversalGBuffer"</code></p>
<p><a class="el" href="namespaceUnity.html">Unity</a> executes the shader with such <code>LightMode</code> tag during the G-buffer Pass.</p>
<p>To indicate that <a class="el" href="namespaceUnity.html">Unity</a> must render a certain Material in the Forward-only Pass in the Deferred Rendering Path, add the following tags to a shader Pass:</p>
<p><code>"LightMode" = "UniversalForwardOnly"</code></p>
<p><code>"LightMode" = "DepthNormalsOnly"</code></p>
<p>To specify the shader lighting model (Lit, SimpleLit), use the <code>UniversalMaterialType</code> tag.</p>
<p>For more information, refer to the section <a href="../urp-shaders/urp-shaderlab-pass-tags.md#lightmode">URP Pass tags: LightMode</a>.</p>
<h1><a class="anchor" id="autotoc_md2357"></a>
Limitations and performance</h1>
<p>This section describes the limitations of the Deferred Rendering Path.</p>
<h2><a class="anchor" id="autotoc_md2358"></a>
Terrain blending</h2>
<p>When blending more than four Terrain layers, the Deferred Rendering Path generates slightly different results from the Forward Rendering Path. This happens because in the Forward Rendering Path, <a class="el" href="namespaceUnity.html">Unity</a> processes the first four layers separately from the next four layers using multi-pass rendering.</p>
<p>In the Forward Rendering Path, <a class="el" href="namespaceUnity.html">Unity</a> merges Material properties and calculates lighting for the combined properties of four layers at once. <a class="el" href="namespaceUnity.html">Unity</a> then processes the next four layers in the same way and alpha-blends the lighting results.</p>
<p>In the Deferred Rendering Path, <a class="el" href="namespaceUnity.html">Unity</a> combines Terrain layers in the G-buffer pass, four layers at a time, and then calculates lighting only once during the deferred rendering pass. This difference with the Forward Rendering Path leads to visually different outcomes.</p>
<p><a class="el" href="namespaceUnity.html">Unity</a> combines the Material properties in the G-buffer using hardware blending (four layers at a time), which limits how correct the combination of property values is. For example, pixel normals cannot be correctly combined using the alpha blend equation alone, because one Terrain layer might contain coarse Terrain detail while another layer might contain fine detail. Averaging or summing normals results in loss of accuracy.</p>
<blockquote class="doxtable">
<p>&zwj;<b>NOTE:</b> Turning the setting Accurate G-buffer normals on breaks Terrain blending. With this setting turned on, <a class="el" href="namespaceUnity.html">Unity</a> encodes normals using octahedron encoding. Normals in different layers encoded this way cannot be blended together because of the bitwise nature of the encoding (2 x 12 bits). If your application requires more than four Terrain layers, turn the <b>Accurate G-buffer normals</b> setting off. </p>
</blockquote>
<p><a class="anchor" id="terrain-visual-diff"></a>The following illustration shows the visual difference when rendering Terrain layers with different Rendering Paths.</p>
<p><img src="../Images/rendering-deferred/terrain-layers-forward.png" alt="Terrain layers rendered with the Forward Rendering Path" class="inline"/><br  />
<em>Terrain layers rendered with the Forward Rendering Path</em></p>
<p><img src="../Images/rendering-deferred/terrain-layers-deferred.png" alt="Terrain layers rendered with the Deferred Rendering Path" class="inline"/><br  />
<em>Terrain layers rendered with the Deferred Rendering Path</em></p>
<h2><a class="anchor" id="autotoc_md2359"></a>
Baked Global Illumination and Lighting Modes</h2>
<p>When Baked Global Illumination is enabled, the Subtractive and the Shadowmask Lighting modes put extra load on the GPU in the Deferred Rendering Path.</p>
<p>The Deferred Rendering Path supports the Subtractive and the Shadowmask Lighting modes for compatibility reasons, but, unlike the case with the Forward Rendering Path, these modes do not provide any improvements in performance. In the Deferred Rendering Path, <a class="el" href="namespaceUnity.html">Unity</a> processes all meshes using the same Lighting algorithm and stores the extra Lighting properties required by Subtractive and the Shadowmask modes in the ShadowMask render target.</p>
<p>In the Deferred Rendering Path, the Baked Indirect Lighting mode provides better performance, since it does not require the ShadowMask render target.</p>
<h2><a class="anchor" id="autotoc_md2360"></a>
Rendering layers</h2>
<p>URP implements the Rendering Layers feature that lets you configure which Lights in a Scene affect specific meshes. Lights assigned to a specific Rendering Layer only affect the meshes assigned to the same Rendering Layer.</p>
<p>For more information on Rendering Layers, refer to the page <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8render-pipelines_8universal_0d14_80_811_609bc2f3052fed77ac8deb7f62c8bc91.html">Rendering Layers</a>.</p>
<p><b>Performance impact</b></p>
<p>The Rendering Layers feature requires an extra G-buffer render target to store the rendering layer mask (32 bits). The extra render target is likely to have a negative impact on GPU performance.</p>
<p><b>Implementation notes</b></p>
<p>In the Forward Rendering Path, the <a href="https://docs.unity3d.com/Manual/Layers.html">Layers</a> feature lets you tell <a class="el" href="namespaceUnity.html">Unity</a> to render specific meshes with a specific set of Lights. The <a href="https://docs.unity3d.com/Manual/Layers.html">Layers</a> feature uses the culling mask system.</p>
<p>The Deferred Rendering Path cannot use the layer system with light culling masks, because the shading is deferred to a later stage in the rendering loop (refer to the <b>Deferred rendering (stencil)</b> step in the Deferred Rendering Path render Passes table.) </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
