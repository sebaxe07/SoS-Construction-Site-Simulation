<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Example of a complete Scriptable Renderer Feature</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Example of a complete Scriptable Renderer Feature</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md2270"></a></p>
<p>This section describes how to create a complete <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8render-pipelines_8universal_0d14_80_811_a14763ddab6dba651873640118156c95.html">Scriptable Renderer Feature</a> for a URP Renderer.</p>
<p>This walkthrough contains the following sections:</p>
<ul>
<li>Overview of this example implementation</li>
<li>Create example Scene and GameObjects</li>
<li>Create a scriptable Renderer Feature and add it to the Universal Renderer<ul>
<li>Add the Renderer Feature to the the Universal Renderer asset</li>
</ul>
</li>
<li>Create the scriptable Render Pass</li>
<li>Implement the settings for the custom render pass</li>
<li>Enqueue the render pass in the custom renderer feature</li>
<li>Implement the volume component</li>
<li>Complete code for the scripts in this example<ul>
<li>Custom Renderer Feature code</li>
<li>Custom render pass code</li>
<li>Volume Component code</li>
</ul>
</li>
<li>The custom shader for the blur effect</li>
</ul>
<h1><a class="anchor" id="autotoc_md2271"></a>
<a class="anchor" id="example-implementation-overview"></a>Overview of this example implementation</h1>
<p>The example workflow on this page implements a custom Renderer Feature that uses <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8render-pipelines_8universal_0d14_80_811_7b1687a204daed5331cab8f330e8f24e.html">custom Render Passes</a> to add a blur effect to the camera output.</p>
<p>The implementation consists of the following parts:</p>
<ul>
<li>A <code>ScriptableRendererFeature</code> instance that enqueues a <code>ScriptableRenderPass</code> instance every frame.</li>
<li>A <code>ScriptableRenderPass</code> instance that performs the following steps:<ul>
<li>Creates a temporary render texture using the <code>RenderTextureDescriptor</code> API.</li>
<li>Applies two passes of the custom shader to the camera output using the <code>RTHandle</code> and the <code>Blit</code> API.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md2272"></a>
<a class="anchor" id="example-scene"></a>Create example Scene and GameObjects</h1>
<p>To set your project up for this example workflow:</p>
<ol type="1">
<li>Create a new Scene.</li>
</ol>
<ol type="1">
<li>Create two GameObjects: a Cube GameObject called <code>Cube</code>, and a Sphere GameObject called <code>Sphere</code>.</li>
<li>Create two Materials with a shader that lets you specify the base color (for example, the <code>Universal Render Pipeline/Lit</code> shader). Call the Materials <code>Blue</code> and <code>Red</code>, and set the base colors of the Materials to blue and red respectively.</li>
<li>Assign the <code>Red</code> Material to the cube and the <code>Blue</code> Material to the sphere.</li>
</ol>
<ol type="1">
<li>Position the camera so that it has the cube and the sphere in its view.</li>
</ol>
<p>The sample scene should look like the following image:</p>
<p><img src="../Images/customizing-urp/custom-renderer-feature/sample-scene.png" alt="Sample scene" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md2273"></a>
<a class="anchor" id="scriptable-renderer-feature"></a>Create a scriptable Renderer Feature and add it to the Universal Renderer</h1>
<ol type="1">
<li>Create a new C# script and name it <code>BlurRendererFeature.cs</code>.</li>
<li>In the script, remove the code that <a class="el" href="namespaceUnity.html">Unity</a> inserted in the <code>BlurRendererFeature</code> class.</li>
<li><p class="startli">Add the following <code>using</code> directive:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">using </span>UnityEngine.Rendering.Universal;</div>
</div><!-- fragment --></li>
</ol>
<ol type="1">
<li><p class="startli">Create the <code>BlurRendererFeature</code> class that inherits from the <b>ScriptableRendererFeature</b> class.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">public</span> <span class="keyword">class </span>BlurRendererFeature : <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1Universal_1_1ScriptableRendererFeature.html">ScriptableRendererFeature</a>    </div>
<div class="ttc" id="aclassUnityEngine_1_1Rendering_1_1Universal_1_1ScriptableRendererFeature_html"><div class="ttname"><a href="classUnityEngine_1_1Rendering_1_1Universal_1_1ScriptableRendererFeature.html">UnityEngine.Rendering.Universal.ScriptableRendererFeature</a></div><div class="ttdoc">You can add a ScriptableRendererFeature to the ScriptableRenderer. Use this scriptable renderer featu...</div><div class="ttdef"><b>Definition</b> ScriptableRendererFeature.cs:13</div></div>
</div><!-- fragment --></li>
<li>In the <code>BlurRendererFeature</code> class, implement the following methods:<ul>
<li><code>Create</code>: <a class="el" href="namespaceUnity.html">Unity</a> calls this method on the following events:<ul>
<li>When the Renderer Feature loads the first time.</li>
<li>When you enable or disable the Renderer Feature.</li>
<li>When you change a property in the inspector of the Renderer Feature.</li>
</ul>
</li>
<li><code>AddRenderPasses</code>: <a class="el" href="namespaceUnity.html">Unity</a> calls this method every frame, once for each camera. This method lets you inject <code>ScriptableRenderPass</code> instances into the scriptable Renderer.</li>
</ul>
</li>
</ol>
<p>Now you have the custom <code>BlurRendererFeature</code> Renderer Feature with its main methods.</p>
<p>Below is the complete code for this step.</p>
<div class="fragment"><div class="line"><span class="preprocessor"> #</span></div>
<div class="line"><span class="keyword">using </span>System.Collections;</div>
<div class="line"><span class="keyword">using </span>System.Collections.Generic;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespaceUnityEngine.html">UnityEngine</a>;</div>
<div class="line"><span class="keyword">using </span>UnityEngine.Rendering.Universal;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>BlurRendererFeature : <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1Universal_1_1ScriptableRendererFeature.html">ScriptableRendererFeature</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Create()</div>
<div class="line">    {</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> AddRenderPasses(<a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1Universal_1_1ScriptableRenderer.html">ScriptableRenderer</a> renderer,</div>
<div class="line">        ref <a class="code hl_struct" href="structUnityEngine_1_1Rendering_1_1Universal_1_1RenderingData.html">RenderingData</a> renderingData)</div>
<div class="line">    {</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassUnityEngine_1_1Rendering_1_1Universal_1_1ScriptableRenderer_html"><div class="ttname"><a href="classUnityEngine_1_1Rendering_1_1Universal_1_1ScriptableRenderer.html">UnityEngine.Rendering.Universal.ScriptableRenderer</a></div><div class="ttdoc">Class ScriptableRenderer implements a rendering strategy. It describes how culling and lighting works...</div><div class="ttdef"><b>Definition</b> ScriptableRenderer.cs:26</div></div>
<div class="ttc" id="anamespaceUnityEngine_html"><div class="ttname"><a href="namespaceUnityEngine.html">UnityEngine</a></div><div class="ttdef"><b>Definition</b> IAnimationPreviewable.cs:4</div></div>
<div class="ttc" id="astructUnityEngine_1_1Rendering_1_1Universal_1_1RenderingData_html"><div class="ttname"><a href="structUnityEngine_1_1Rendering_1_1Universal_1_1RenderingData.html">UnityEngine.Rendering.Universal.RenderingData</a></div><div class="ttdoc">Struct that flattens several rendering settings used to render a camera stack. URP builds the Renderi...</div><div class="ttdef"><b>Definition</b> UniversalRenderPipelineCore.cs:85</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2274"></a>
<a class="anchor" id="add-renderer-feature-to-asset"></a>Add the Renderer Feature to the the Universal Renderer asset</h2>
<p>Add the Renderer Feature you created to the the Universal Renderer asset. For information on how to do this, refer to the page <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8render-pipelines_8universal_0d14_80_811_0e23c3b48e65e07bc63846f1a8790cf4.html">How to add a Renderer Feature to a Renderer</a>.</p>
<h1><a class="anchor" id="autotoc_md2275"></a>
<a class="anchor" id="scriptable-render-pass"></a>Create the scriptable Render Pass</h1>
<p>This section demonstrates how to create a scriptable Render Pass and enqueue its instance into the scriptable Renderer.</p>
<ol type="1">
<li>Create a new C# script and name it <code>BlurRenderPass.cs</code>.</li>
<li><p class="startli">In the script, remove the code that <a class="el" href="namespaceUnity.html">Unity</a> inserted in the <code>BlurRenderPass</code> class. Add the following <code>using</code> directive:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">using </span>UnityEngine.Rendering;</div>
<div class="line">   <span class="keyword">using </span>UnityEngine.Rendering.Universal;</div>
</div><!-- fragment --></li>
<li><p class="startli">Create the <code>BlurRenderPass</code> class that inherits from the <b>ScriptableRenderPass</b> class.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">public</span> <span class="keyword">class </span>BlurRenderPass : <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1Universal_1_1ScriptableRenderPass.html">ScriptableRenderPass</a></div>
<div class="ttc" id="aclassUnityEngine_1_1Rendering_1_1Universal_1_1ScriptableRenderPass_html"><div class="ttname"><a href="classUnityEngine_1_1Rendering_1_1Universal_1_1ScriptableRenderPass.html">UnityEngine.Rendering.Universal.ScriptableRenderPass</a></div><div class="ttdoc">ScriptableRenderPass implements a logical rendering pass that can be used to extend Universal RP rend...</div><div class="ttdef"><b>Definition</b> ScriptableRenderPass.cs:174</div></div>
</div><!-- fragment --></li>
<li><p class="startli">Add the <code>Execute</code> method to the class. <a class="el" href="namespaceUnity.html">Unity</a> calls this method every frame, once for each camera. This method lets you implement the rendering logic of the scriptable Render Pass.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Execute(ScriptableRenderContext context, ref <a class="code hl_struct" href="structUnityEngine_1_1Rendering_1_1Universal_1_1RenderingData.html">RenderingData</a> renderingData)</div>
<div class="line">   { }</div>
</div><!-- fragment --></li>
</ol>
<p>Below is the complete code for the BlurRenderPass.cs file from this section.</p>
<div class="fragment"><div class="line"><span class="preprocessor"> #</span></div>
<div class="line"><span class="keyword">using </span>UnityEngine.Rendering;</div>
<div class="line"><span class="keyword">using </span>UnityEngine.Rendering.Universal;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>BlurRenderPass : <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1Universal_1_1ScriptableRenderPass.html">ScriptableRenderPass</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Execute(ScriptableRenderContext context,</div>
<div class="line">        ref <a class="code hl_struct" href="structUnityEngine_1_1Rendering_1_1Universal_1_1RenderingData.html">RenderingData</a> renderingData)</div>
<div class="line">    {</div>
<div class="line">        </div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2276"></a>
Implement the settings for the custom render pass</h1>
<p>This section demonstrates how to implement the settings for the custom blur render pass.</p>
<ol type="1">
<li><p class="startli">The Renderer Feature in this example uses the shader that performs the blur horizontally in one pass, and vertically in another pass. To let users control the blur value for each pass, add the following <code>BlurSettings</code> class to the <code>BlurRendererFeature.cs</code> script.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   [Serializable]</div>
<div class="line">   <span class="keyword">public</span> <span class="keyword">class </span>BlurSettings</div>
<div class="line">   {</div>
<div class="line">       [Range(0,0.4f)] <span class="keyword">public</span> <span class="keywordtype">float</span> horizontalBlur;</div>
<div class="line">       [Range(0,0.4f)] <span class="keyword">public</span> <span class="keywordtype">float</span> verticalBlur;</div>
<div class="line">   }</div>
</div><!-- fragment --></li>
<li><p class="startli">In the <code>BlurRendererFeature</code> class, declare the following fields:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   [SerializeField] <span class="keyword">private</span> BlurSettings settings;</div>
<div class="line">   [SerializeField] <span class="keyword">private</span> Shader shader;</div>
<div class="line">   <span class="keyword">private</span> Material material;</div>
<div class="line">   <span class="keyword">private</span> BlurRenderPass blurRenderPass;</div>
</div><!-- fragment --></li>
<li><p class="startli">In the <code>BlurRenderPass</code> class, add the fields for the settings, the Material, and the constructor that uses those fields.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">private</span> BlurSettings defaultSettings;</div>
<div class="line">   <span class="keyword">private</span> Material material;</div>
<div class="line"> </div>
<div class="line">   <span class="keyword">public</span> BlurRenderPass(Material material, BlurSettings defaultSettings)</div>
<div class="line">   {</div>
<div class="line">       this.material = material;</div>
<div class="line">       this.defaultSettings = defaultSettings;        </div>
<div class="line">   }</div>
</div><!-- fragment --></li>
<li><p class="startli">In the <code>BlurRenderPass</code> class, add the <code>RenderTextureDescriptor</code> field and initialize it in the constructor:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">using </span><a class="code hl_namespace" href="namespaceUnityEngine.html">UnityEngine</a>;</div>
<div class="line"> </div>
<div class="line">   <span class="keyword">private</span> RenderTextureDescriptor blurTextureDescriptor;</div>
<div class="line"> </div>
<div class="line">   <span class="keyword">public</span> BlurRenderPass(Material material, BlurSettings defaultSettings)</div>
<div class="line">   {</div>
<div class="line">       this.material = material;</div>
<div class="line">       this.defaultSettings = defaultSettings;</div>
<div class="line"> </div>
<div class="line">       blurTextureDescriptor = <span class="keyword">new</span> RenderTextureDescriptor(Screen.width,</div>
<div class="line">           Screen.height, RenderTextureFormat.Default, 0);</div>
<div class="line">   }</div>
</div><!-- fragment --></li>
<li><p class="startli">In the <code>BlurRenderPass</code> class, declare the <code>RTHandle</code> field to store the reference to the temporary blur texture.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">private</span> <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1RTHandle.html">RTHandle</a> blurTextureHandle;</div>
<div class="ttc" id="aclassUnityEngine_1_1Rendering_1_1RTHandle_html"><div class="ttname"><a href="classUnityEngine_1_1Rendering_1_1RTHandle.html">UnityEngine.Rendering.RTHandle</a></div><div class="ttdoc">A RTHandle is a RenderTexture that scales automatically with the camera size. This allows proper reut...</div><div class="ttdef"><b>Definition</b> RTHandle.cs:59</div></div>
</div><!-- fragment --></li>
<li><p class="startli">In the <code>BlurRenderPass</code> class, implement the <code>Configure</code> method. <a class="el" href="namespaceUnity.html">Unity</a> calls this method before executing the render pass.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Configure(CommandBuffer cmd,</div>
<div class="line">       RenderTextureDescriptor cameraTextureDescriptor)</div>
<div class="line">   {</div>
<div class="line">       <span class="comment">//Set the blur texture size to be the same as the camera target size.</span></div>
<div class="line">       blurTextureDescriptor.width = cameraTextureDescriptor.width;</div>
<div class="line">       blurTextureDescriptor.height = cameraTextureDescriptor.height;</div>
<div class="line"> </div>
<div class="line">       <span class="comment">//Check if the descriptor has changed, and reallocate the RTHandle if necessary.</span></div>
<div class="line">       RenderingUtils.ReAllocateIfNeeded(ref blurTextureHandle, blurTextureDescriptor);</div>
<div class="line">   }</div>
</div><!-- fragment --></li>
<li><p class="startli">In the <code>BlurRenderPass</code> class, implement the <code>UpdateBlurSettings</code> method that updates the shader values.</p>
<p class="startli">Use the <code>Blit</code> method to apply the two passes from the custom shader to the camera output.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">private</span> <span class="keyword">static</span> readonly <span class="keywordtype">int</span> horizontalBlurId =</div>
<div class="line">       Shader.PropertyToID(<span class="stringliteral">&quot;_HorizontalBlur&quot;</span>);</div>
<div class="line">   <span class="keyword">private</span> <span class="keyword">static</span> readonly <span class="keywordtype">int</span> verticalBlurId =</div>
<div class="line">       Shader.PropertyToID(<span class="stringliteral">&quot;_VerticalBlur&quot;</span>);</div>
<div class="line"> </div>
<div class="line">   ...</div>
<div class="line"> </div>
<div class="line">   <span class="keyword">private</span> <span class="keywordtype">void</span> UpdateBlurSettings()</div>
<div class="line">   {</div>
<div class="line">       <span class="keywordflow">if</span> (material == null) <span class="keywordflow">return</span>;</div>
<div class="line">               </div>
<div class="line">       material.SetFloat(horizontalBlurId, defaultSettings.horizontalBlur);</div>
<div class="line">       material.SetFloat(verticalBlurId, defaultSettings.verticalBlur);</div>
<div class="line">   }</div>
</div><!-- fragment --></li>
<li><p class="startli">Call the <code>UpdateBlurSettings</code> method in the <code>Execute</code> method.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Execute(ScriptableRenderContext context,</div>
<div class="line">       ref <a class="code hl_struct" href="structUnityEngine_1_1Rendering_1_1Universal_1_1RenderingData.html">RenderingData</a> renderingData)</div>
<div class="line">   {</div>
<div class="line">       <span class="comment">//Get a CommandBuffer from pool.</span></div>
<div class="line">       CommandBuffer cmd = CommandBufferPool.Get();</div>
<div class="line"> </div>
<div class="line">       <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1RTHandle.html">RTHandle</a> cameraTargetHandle =</div>
<div class="line">           renderingData.cameraData.renderer.cameraColorTargetHandle;</div>
<div class="line"> </div>
<div class="line">       UpdateBlurSettings();</div>
<div class="line"> </div>
<div class="line">       <span class="comment">// Blit from the camera target to the temporary render texture,</span></div>
<div class="line">       <span class="comment">// using the first shader pass.</span></div>
<div class="line">       Blit(cmd, cameraTargetHandle, blurTextureHandle, material, 0);</div>
<div class="line">       <span class="comment">// Blit from the temporary render texture to the camera target,</span></div>
<div class="line">       <span class="comment">// using the second shader pass.</span></div>
<div class="line">       Blit(cmd, blurTextureHandle, cameraTargetHandle, material, 1);</div>
<div class="line"> </div>
<div class="line">       <span class="comment">//Execute the command buffer and release it back to the pool.</span></div>
<div class="line">       context.ExecuteCommandBuffer(cmd);</div>
<div class="line">       CommandBufferPool.Release(cmd);</div>
<div class="line">   }</div>
</div><!-- fragment --></li>
<li><p class="startli">Implement the <code>Dispose</code> method that destroys the Material and the temporary render texture after the render pass execution.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">public</span> <span class="keywordtype">void</span> Dispose()</div>
<div class="line">   {</div>
<div class="line"><span class="preprocessor">       #if UNITY_EDITOR</span></div>
<div class="line">               <span class="keywordflow">if</span> (EditorApplication.isPlaying)</div>
<div class="line">               {</div>
<div class="line">                   Object.Destroy(material);</div>
<div class="line">               }</div>
<div class="line">               <span class="keywordflow">else</span></div>
<div class="line">               {</div>
<div class="line">                   Object.DestroyImmediate(material);</div>
<div class="line">               }</div>
<div class="line"><span class="preprocessor">       #else</span></div>
<div class="line">               Object.Destroy(material);</div>
<div class="line"><span class="preprocessor">       #endif</span></div>
<div class="line">       </div>
<div class="line">       <span class="keywordflow">if</span> (blurTextureHandle != null) blurTextureHandle.<a class="code hl_function" href="classUnityEngine_1_1Rendering_1_1RTHandle.html#a54dcb7d7d149714fa8d80c9f68046f12">Release</a>();</div>
<div class="line">   }</div>
<div class="ttc" id="aclassUnityEngine_1_1Rendering_1_1RTHandle_html_a54dcb7d7d149714fa8d80c9f68046f12"><div class="ttname"><a href="classUnityEngine_1_1Rendering_1_1RTHandle.html#a54dcb7d7d149714fa8d80c9f68046f12">UnityEngine.Rendering.RTHandle.Release</a></div><div class="ttdeci">void Release()</div><div class="ttdoc">Release the RTHandle.</div><div class="ttdef"><b>Definition</b> RTHandle.cs:212</div></div>
</div><!-- fragment --></li>
</ol>
<p>The complete code for this part is in section Custom render pass code.</p>
<h1><a class="anchor" id="autotoc_md2277"></a>
Enqueue the render pass in the custom renderer feature</h1>
<p>In this section, you instantiate the render pass in the <code>Create</code> method of the <code>BlurRendererFeature</code> class, and enqueue it in the <code>AddRenderPasses</code> method.</p>
<ol type="1">
<li><p class="startli">In the <code>Create</code> method of the <code>BlurRendererFeature</code> class, instantiate the <code>BlurRenderPass</code> class.</p>
<p class="startli">In the method, use the <code>renderPassEvent</code> field to specify when to execute the render pass.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Create()</div>
<div class="line">   {</div>
<div class="line">       <span class="keywordflow">if</span> (shader == null)</div>
<div class="line">       {</div>
<div class="line">           <span class="keywordflow">return</span>;</div>
<div class="line">       }</div>
<div class="line">       material = <span class="keyword">new</span> Material(shader);</div>
<div class="line">       blurRenderPass = <span class="keyword">new</span> BlurRenderPass(material, settings);</div>
<div class="line"> </div>
<div class="line">       renderPassEvent = <a class="code hl_enumeration" href="namespaceUnityEngine_1_1Rendering_1_1Universal.html#abcf86de95108d2ec392bc873e92392d5">RenderPassEvent</a>.AfterRenderingSkybox;</div>
<div class="line">   }</div>
<div class="ttc" id="anamespaceUnityEngine_1_1Rendering_1_1Universal_html_abcf86de95108d2ec392bc873e92392d5"><div class="ttname"><a href="namespaceUnityEngine_1_1Rendering_1_1Universal.html#abcf86de95108d2ec392bc873e92392d5">UnityEngine.Rendering.Universal.RenderPassEvent</a></div><div class="ttdeci">RenderPassEvent</div><div class="ttdoc">Controls when the render pass executes.</div><div class="ttdef"><b>Definition</b> ScriptableRenderPass.cs:52</div></div>
</div><!-- fragment --></li>
<li><p class="startli">In the <code>AddRenderPasses</code> method of the <code>BlurRendererFeature</code> class, enqueue the render pass with the <code>EnqueuePass</code> method.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> AddRenderPasses(<a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1Universal_1_1ScriptableRenderer.html">ScriptableRenderer</a> renderer, ref <a class="code hl_struct" href="structUnityEngine_1_1Rendering_1_1Universal_1_1RenderingData.html">RenderingData</a> renderingData)</div>
<div class="line">   {</div>
<div class="line">       <span class="keywordflow">if</span> (renderingData.cameraData.cameraType == CameraType.Game)</div>
<div class="line">       {</div>
<div class="line">           renderer.<a class="code hl_function" href="classUnityEngine_1_1Rendering_1_1Universal_1_1ScriptableRenderer.html#adef70d792e8e83c7feab314db83b02f2">EnqueuePass</a>(blurRenderPass);</div>
<div class="line">       }</div>
<div class="line">   }</div>
<div class="ttc" id="aclassUnityEngine_1_1Rendering_1_1Universal_1_1ScriptableRenderer_html_adef70d792e8e83c7feab314db83b02f2"><div class="ttname"><a href="classUnityEngine_1_1Rendering_1_1Universal_1_1ScriptableRenderer.html#adef70d792e8e83c7feab314db83b02f2">UnityEngine.Rendering.Universal.ScriptableRenderer.EnqueuePass</a></div><div class="ttdeci">void EnqueuePass(ScriptableRenderPass pass)</div><div class="ttdoc">Enqueues a render pass for execution.</div><div class="ttdef"><b>Definition</b> ScriptableRenderer.cs:1278</div></div>
</div><!-- fragment --></li>
<li><p class="startli">Implement the <code>Dispose</code> method that destroys the material instance that the Renderer Feature creates. The method also calls the <code>Dispose</code> method from the render pass class.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Dispose(<span class="keywordtype">bool</span> disposing)</div>
<div class="line">   {</div>
<div class="line">       blurRenderPass.Dispose();</div>
<div class="line"><span class="preprocessor">       #if UNITY_EDITOR</span></div>
<div class="line">           <span class="keywordflow">if</span> (EditorApplication.isPlaying)</div>
<div class="line">           {</div>
<div class="line">               Destroy(material);</div>
<div class="line">           }</div>
<div class="line">           <span class="keywordflow">else</span></div>
<div class="line">           {</div>
<div class="line">               DestroyImmediate(material);</div>
<div class="line">           }</div>
<div class="line"><span class="preprocessor">       #else</span></div>
<div class="line">               Destroy(material);</div>
<div class="line"><span class="preprocessor">       #endif</span></div>
<div class="line">   }</div>
</div><!-- fragment --></li>
</ol>
<p>For the complete Renderer Feature code, refer to section Custom Renderer Feature code.</p>
<p>The Scriptable Renderer Feature is now complete. The following image shows the effect of the feature in the Game view and the example settings.</p>
<p><img src="../Images/customizing-urp/custom-renderer-feature/final-effect.png" alt="The effect of the Scriptable Renderer Feature in the Game view" class="inline"/><br  />
<em>The effect of the Scriptable Renderer Feature in the Game view.</em></p>
<h1><a class="anchor" id="autotoc_md2278"></a>
<a class="anchor" id="volume-component"></a>Implement the volume component</h1>
<p>This section shows how to implement a volume component that lets you control the input values for the custom renderer feature.</p>
<ol type="1">
<li>Create a new C# script and name it <code>CustomVolumeComponent.cs</code>.</li>
</ol>
<ol type="1">
<li><p class="startli">Inherit the <code>CustomVolumeComponent</code> class from the <code>VolumeComponent</code> class, add the <code>[Serializable]</code> attribute to the class. Add the <code>using <a class="el" href="namespaceUnityEngine_1_1Rendering.html">UnityEngine.Rendering</a>;</code> directive.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">using </span>System;</div>
<div class="line">   <span class="keyword">using </span>UnityEngine.Rendering;</div>
<div class="line"> </div>
<div class="line">   [Serializable]</div>
<div class="line">   <span class="keyword">public</span> <span class="keyword">class </span>CustomVolumeComponent : <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1VolumeComponent.html">VolumeComponent</a></div>
<div class="line">   {</div>
<div class="line"> </div>
<div class="line">   }</div>
<div class="ttc" id="aclassUnityEngine_1_1Rendering_1_1VolumeComponent_html"><div class="ttname"><a href="classUnityEngine_1_1Rendering_1_1VolumeComponent.html">UnityEngine.Rendering.VolumeComponent</a></div><div class="ttdoc">The base class for all the components that can be part of a VolumeProfile. The Volume framework autom...</div><div class="ttdef"><b>Definition</b> VolumeComponent.cs:96</div></div>
</div><!-- fragment --></li>
<li><p class="startli">Add the <code>BoolParameter</code> field to the <code>CustomVolumeComponent</code> class. This field lets you enable or disable the custom renderer feature.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">public</span> <span class="keyword">class </span>BlurVolumeComponent : <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1VolumeComponent.html">VolumeComponent</a></div>
<div class="line">   {</div>
<div class="line">       <span class="keyword">public</span> <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1BoolParameter.html">BoolParameter</a> isActive = <span class="keyword">new</span> <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1BoolParameter.html">BoolParameter</a>(<span class="keyword">true</span>);</div>
<div class="line">   }</div>
<div class="ttc" id="aclassUnityEngine_1_1Rendering_1_1BoolParameter_html"><div class="ttname"><a href="classUnityEngine_1_1Rendering_1_1BoolParameter.html">UnityEngine.Rendering.BoolParameter</a></div><div class="ttdoc">A VolumeParameter that holds a bool value.</div><div class="ttdef"><b>Definition</b> VolumeParameter.cs:340</div></div>
</div><!-- fragment --></li>
<li><p class="startli">Add the fields to control the blur settings defined in the custom renderer feature.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   [Serializable]</div>
<div class="line">   <span class="keyword">public</span> <span class="keyword">class </span>CustomVolumeComponent : <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1VolumeComponent.html">VolumeComponent</a></div>
<div class="line">   {</div>
<div class="line">       <span class="keyword">public</span> <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1BoolParameter.html">BoolParameter</a> isActive = <span class="keyword">new</span> <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1BoolParameter.html">BoolParameter</a>(<span class="keyword">true</span>);</div>
<div class="line">       <span class="keyword">public</span> <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1ClampedFloatParameter.html">ClampedFloatParameter</a> horizontalBlur =</div>
<div class="line">           <span class="keyword">new</span> <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1ClampedFloatParameter.html">ClampedFloatParameter</a>(0.05f, 0, 0.5f);</div>
<div class="line">       <span class="keyword">public</span> <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1ClampedFloatParameter.html">ClampedFloatParameter</a> verticalBlur =</div>
<div class="line">           <span class="keyword">new</span> <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1ClampedFloatParameter.html">ClampedFloatParameter</a>(0.05f, 0, 0.5f);</div>
<div class="line">   }</div>
<div class="ttc" id="aclassUnityEngine_1_1Rendering_1_1ClampedFloatParameter_html"><div class="ttname"><a href="classUnityEngine_1_1Rendering_1_1ClampedFloatParameter.html">UnityEngine.Rendering.ClampedFloatParameter</a></div><div class="ttdoc">A VolumeParameter that holds a float value clamped between a minimum and a maximum value.</div><div class="ttdef"><b>Definition</b> VolumeParameter.cs:999</div></div>
</div><!-- fragment --></li>
<li><p class="startli">In the <code>BlurRenderPass</code> script, change the <code>UpdateBlurSettings</code> method so that it uses the settings defined in a Volume or the default settings if no Volume is set.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">private</span> <span class="keywordtype">void</span> UpdateBlurSettings()</div>
<div class="line">   {</div>
<div class="line">       <span class="keywordflow">if</span> (material == null) <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">       <span class="comment">// Use the Volume settings or the default settings if no Volume is set.</span></div>
<div class="line">       var volumeComponent =</div>
<div class="line">           <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1VolumeManager.html">VolumeManager</a>.<a class="code hl_property" href="classUnityEngine_1_1Rendering_1_1VolumeManager.html#a553cb6be545d16faace2634b92ddea71">instance</a>.<a class="code hl_property" href="classUnityEngine_1_1Rendering_1_1VolumeManager.html#a5c023c97ff46b228ee376eaf3b6f91b4">stack</a>.<a class="code hl_function" href="classUnityEngine_1_1Rendering_1_1VolumeStack.html#a469bc5b7565e916ad44a02ae8b639ae9">GetComponent</a>&lt;CustomVolumeComponent&gt;();</div>
<div class="line">       <span class="keywordtype">float</span> horizontalBlur = volumeComponent.horizontalBlur.overrideState ?</div>
<div class="line">           volumeComponent.horizontalBlur.value : defaultSettings.horizontalBlur;</div>
<div class="line">       <span class="keywordtype">float</span> verticalBlur = volumeComponent.verticalBlur.overrideState ?</div>
<div class="line">           volumeComponent.verticalBlur.value : defaultSettings.verticalBlur;</div>
<div class="line">       material.SetFloat(horizontalBlurId, horizontalBlur);</div>
<div class="line">       material.SetFloat(verticalBlurId, verticalBlur);</div>
<div class="line">   }</div>
<div class="ttc" id="aclassUnityEngine_1_1Rendering_1_1VolumeManager_html"><div class="ttname"><a href="classUnityEngine_1_1Rendering_1_1VolumeManager.html">UnityEngine.Rendering.VolumeManager</a></div><div class="ttdoc">A global manager that tracks all the Volumes in the currently loaded Scenes and does all the interpol...</div><div class="ttdef"><b>Definition</b> VolumeManager.cs:20</div></div>
<div class="ttc" id="aclassUnityEngine_1_1Rendering_1_1VolumeManager_html_a553cb6be545d16faace2634b92ddea71"><div class="ttname"><a href="classUnityEngine_1_1Rendering_1_1VolumeManager.html#a553cb6be545d16faace2634b92ddea71">UnityEngine.Rendering.VolumeManager.instance</a></div><div class="ttdeci">static VolumeManager instance</div><div class="ttdoc">The current singleton instance of VolumeManager.</div><div class="ttdef"><b>Definition</b> VolumeManager.cs:26</div></div>
<div class="ttc" id="aclassUnityEngine_1_1Rendering_1_1VolumeManager_html_a5c023c97ff46b228ee376eaf3b6f91b4"><div class="ttname"><a href="classUnityEngine_1_1Rendering_1_1VolumeManager.html#a5c023c97ff46b228ee376eaf3b6f91b4">UnityEngine.Rendering.VolumeManager.stack</a></div><div class="ttdeci">VolumeStack stack</div><div class="ttdoc">A reference to the main VolumeStack.</div><div class="ttdef"><b>Definition</b> VolumeManager.cs:32</div></div>
<div class="ttc" id="aclassUnityEngine_1_1Rendering_1_1VolumeStack_html_a469bc5b7565e916ad44a02ae8b639ae9"><div class="ttname"><a href="classUnityEngine_1_1Rendering_1_1VolumeStack.html#a469bc5b7565e916ad44a02ae8b639ae9">UnityEngine.Rendering.VolumeStack.GetComponent</a></div><div class="ttdeci">VolumeComponent GetComponent(Type type)</div><div class="ttdoc">Gets the current state of the VolumeComponent of the specified type in the stack.</div><div class="ttdef"><b>Definition</b> VolumeStack.cs:91</div></div>
</div><!-- fragment --></li>
<li><p class="startli">In the <a class="el" href="namespaceUnity.html">Unity</a> scene, create a <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8render-pipelines_8universal_0d14_80_811_2Documentation_0i_2Volumes.html">local Box Volume</a>. If a <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8render-pipelines_8universal_0d14_80_811_65502c033f21b4921bd573e2941b9eb0.html">Volume Profile</a> is missing, create a new one by clicking <b>New</b> next to the <b>Profile</b> property. Add the <code>Custom Volume Component</code> <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8render-pipelines_8universal_0d14_80_811_b1f6980d6bdeb81615089a51aeb12d8d.html">override</a> to the Volume.</p>
<p class="startli"><img src="../Images/customizing-urp/custom-renderer-feature/local-volume.png" alt="Box Volume properties" class="inline"/></p>
</li>
<li>Enable the settings in the <code>Custom Volume Component</code> override and set the values for this Volume. Move the Volume so that the camera is inside it. The settings from the Volume override the default settings from the custom renderer feature. <br  />
</li>
</ol>
<h1><a class="anchor" id="autotoc_md2279"></a>
All complete code for the scripts in this example</h1>
<p>This section contains the complete code for all the scripts in this example.</p>
<h2><a class="anchor" id="autotoc_md2280"></a>
<a class="anchor" id="code-renderer-feature"></a>Custom Renderer Feature code</h2>
<p>Below is the complete code for the custom Renderer Feature script.</p>
<div class="fragment"><div class="line"><span class="preprocessor"> #</span></div>
<div class="line"><span class="keyword">using </span>System;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespaceUnityEditor.html">UnityEditor</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespaceUnityEngine.html">UnityEngine</a>;</div>
<div class="line"><span class="keyword">using </span>UnityEngine.Rendering.Universal;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>BlurRendererFeature : <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1Universal_1_1ScriptableRendererFeature.html">ScriptableRendererFeature</a></div>
<div class="line">{</div>
<div class="line">    [SerializeField] <span class="keyword">private</span> BlurSettings settings;</div>
<div class="line">    [SerializeField] <span class="keyword">private</span> Shader shader;</div>
<div class="line">    <span class="keyword">private</span> Material material;</div>
<div class="line">    <span class="keyword">private</span> BlurRenderPass blurRenderPass;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Create()</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (shader == null)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">        material = <span class="keyword">new</span> Material(shader);</div>
<div class="line">        blurRenderPass = <span class="keyword">new</span> BlurRenderPass(material, settings);</div>
<div class="line">        </div>
<div class="line">        blurRenderPass.renderPassEvent = <a class="code hl_enumeration" href="namespaceUnityEngine_1_1Rendering_1_1Universal.html#abcf86de95108d2ec392bc873e92392d5">RenderPassEvent</a>.AfterRenderingSkybox;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> AddRenderPasses(<a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1Universal_1_1ScriptableRenderer.html">ScriptableRenderer</a> renderer,</div>
<div class="line">        ref <a class="code hl_struct" href="structUnityEngine_1_1Rendering_1_1Universal_1_1RenderingData.html">RenderingData</a> renderingData)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (renderingData.cameraData.cameraType == CameraType.Game)</div>
<div class="line">        {</div>
<div class="line">            renderer.<a class="code hl_function" href="classUnityEngine_1_1Rendering_1_1Universal_1_1ScriptableRenderer.html#adef70d792e8e83c7feab314db83b02f2">EnqueuePass</a>(blurRenderPass);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Dispose(<span class="keywordtype">bool</span> disposing)</div>
<div class="line">    {</div>
<div class="line">        blurRenderPass.Dispose();</div>
<div class="line"><span class="preprocessor">        #if UNITY_EDITOR</span></div>
<div class="line">            <span class="keywordflow">if</span> (EditorApplication.isPlaying)</div>
<div class="line">            {</div>
<div class="line">                Destroy(material);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                DestroyImmediate(material);</div>
<div class="line">            }</div>
<div class="line"><span class="preprocessor">        #else</span></div>
<div class="line">                Destroy(material);</div>
<div class="line"><span class="preprocessor">        #endif</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">[Serializable]</div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>BlurSettings</div>
<div class="line">{</div>
<div class="line">    [Range(0, 0.4f)] <span class="keyword">public</span> <span class="keywordtype">float</span> horizontalBlur;</div>
<div class="line">    [Range(0, 0.4f)] <span class="keyword">public</span> <span class="keywordtype">float</span> verticalBlur;</div>
<div class="line">}</div>
<div class="ttc" id="anamespaceUnityEditor_html"><div class="ttname"><a href="namespaceUnityEditor.html">UnityEditor</a></div><div class="ttdef"><b>Definition</b> ImagePacker.cs:11</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2281"></a>
<a class="anchor" id="code-render-pass"></a>Custom render pass code</h2>
<p>Below is the complete code for the custom Render Pass script.</p>
<div class="fragment"><div class="line"><span class="preprocessor"> #</span></div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespaceUnityEditor.html">UnityEditor</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespaceUnityEngine.html">UnityEngine</a>;</div>
<div class="line"><span class="keyword">using </span>UnityEngine.Rendering;</div>
<div class="line"><span class="keyword">using </span>UnityEngine.Rendering.Universal;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>BlurRenderPass : <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1Universal_1_1ScriptableRenderPass.html">ScriptableRenderPass</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> readonly <span class="keywordtype">int</span> horizontalBlurId =</div>
<div class="line">        Shader.PropertyToID(<span class="stringliteral">&quot;_HorizontalBlur&quot;</span>);</div>
<div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> readonly <span class="keywordtype">int</span> verticalBlurId =</div>
<div class="line">        Shader.PropertyToID(<span class="stringliteral">&quot;_VerticalBlur&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">private</span> BlurSettings defaultSettings;</div>
<div class="line">    <span class="keyword">private</span> Material material;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">private</span> RenderTextureDescriptor blurTextureDescriptor;</div>
<div class="line">    <span class="keyword">private</span> <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1RTHandle.html">RTHandle</a> blurTextureHandle;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> BlurRenderPass(Material material, BlurSettings defaultSettings)</div>
<div class="line">    {</div>
<div class="line">        this.material = material;</div>
<div class="line">        this.defaultSettings = defaultSettings;</div>
<div class="line"> </div>
<div class="line">        blurTextureDescriptor = <span class="keyword">new</span> RenderTextureDescriptor(Screen.width,</div>
<div class="line">            Screen.height, RenderTextureFormat.Default, 0);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Configure(CommandBuffer cmd,</div>
<div class="line">        RenderTextureDescriptor cameraTextureDescriptor)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Set the blur texture size to be the same as the camera target size.</span></div>
<div class="line">        blurTextureDescriptor.width = cameraTextureDescriptor.width;</div>
<div class="line">        blurTextureDescriptor.height = cameraTextureDescriptor.height;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Check if the descriptor has changed, and reallocate the RTHandle if necessary</span></div>
<div class="line">        RenderingUtils.ReAllocateIfNeeded(ref blurTextureHandle, blurTextureDescriptor);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> UpdateBlurSettings()</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (material == null) <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Use the Volume settings or the default settings if no Volume is set.</span></div>
<div class="line">        var volumeComponent =</div>
<div class="line">            <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1VolumeManager.html">VolumeManager</a>.<a class="code hl_property" href="classUnityEngine_1_1Rendering_1_1VolumeManager.html#a553cb6be545d16faace2634b92ddea71">instance</a>.<a class="code hl_property" href="classUnityEngine_1_1Rendering_1_1VolumeManager.html#a5c023c97ff46b228ee376eaf3b6f91b4">stack</a>.<a class="code hl_function" href="classUnityEngine_1_1Rendering_1_1VolumeStack.html#a469bc5b7565e916ad44a02ae8b639ae9">GetComponent</a>&lt;CustomVolumeComponent&gt;();</div>
<div class="line">        <span class="keywordtype">float</span> horizontalBlur = volumeComponent.horizontalBlur.overrideState ?</div>
<div class="line">            volumeComponent.horizontalBlur.value : defaultSettings.horizontalBlur;</div>
<div class="line">        <span class="keywordtype">float</span> verticalBlur = volumeComponent.verticalBlur.overrideState ?</div>
<div class="line">            volumeComponent.verticalBlur.value : defaultSettings.verticalBlur;</div>
<div class="line">        material.SetFloat(horizontalBlurId, horizontalBlur);</div>
<div class="line">        material.SetFloat(verticalBlurId, verticalBlur);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Execute(ScriptableRenderContext context,</div>
<div class="line">        ref <a class="code hl_struct" href="structUnityEngine_1_1Rendering_1_1Universal_1_1RenderingData.html">RenderingData</a> renderingData)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//Get a CommandBuffer from pool.</span></div>
<div class="line">        CommandBuffer cmd = CommandBufferPool.Get();</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1RTHandle.html">RTHandle</a> cameraTargetHandle =</div>
<div class="line">            renderingData.cameraData.renderer.cameraColorTargetHandle;</div>
<div class="line"> </div>
<div class="line">        UpdateBlurSettings();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Blit from the camera target to the temporary render texture,</span></div>
<div class="line">        <span class="comment">// using the first shader pass.</span></div>
<div class="line">        Blit(cmd, cameraTargetHandle, blurTextureHandle, material, 0);</div>
<div class="line">        <span class="comment">// Blit from the temporary render texture to the camera target,</span></div>
<div class="line">        <span class="comment">// using the second shader pass.</span></div>
<div class="line">        Blit(cmd, blurTextureHandle, cameraTargetHandle, material, 1);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">//Execute the command buffer and release it back to the pool.</span></div>
<div class="line">        context.ExecuteCommandBuffer(cmd);</div>
<div class="line">        CommandBufferPool.Release(cmd);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> Dispose()</div>
<div class="line">    {</div>
<div class="line"><span class="preprocessor">    #if UNITY_EDITOR</span></div>
<div class="line">        <span class="keywordflow">if</span> (EditorApplication.isPlaying)</div>
<div class="line">        {</div>
<div class="line">            Object.Destroy(material);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            Object.DestroyImmediate(material);</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">    #else</span></div>
<div class="line">                Object.Destroy(material);</div>
<div class="line"><span class="preprocessor">    #endif</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (blurTextureHandle != null) blurTextureHandle.<a class="code hl_function" href="classUnityEngine_1_1Rendering_1_1RTHandle.html#a54dcb7d7d149714fa8d80c9f68046f12">Release</a>();</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2282"></a>
<a class="anchor" id="code-volume-component"></a>Volume Component code</h2>
<p>Below is the complete code for the Volume Component script.</p>
<div class="fragment"><div class="line"><span class="preprocessor"> #</span></div>
<div class="line"><span class="keyword">using </span>System;</div>
<div class="line"><span class="keyword">using </span>UnityEngine.Rendering;</div>
<div class="line"> </div>
<div class="line">[Serializable]</div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>CustomVolumeComponent : <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1VolumeComponent.html">VolumeComponent</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span> <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1BoolParameter.html">BoolParameter</a> isActive = <span class="keyword">new</span> <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1BoolParameter.html">BoolParameter</a>(<span class="keyword">true</span>);</div>
<div class="line">    <span class="keyword">public</span> <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1ClampedFloatParameter.html">ClampedFloatParameter</a> horizontalBlur =</div>
<div class="line">        <span class="keyword">new</span> <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1ClampedFloatParameter.html">ClampedFloatParameter</a>(0.05f, 0, 0.5f);</div>
<div class="line">    <span class="keyword">public</span> <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1ClampedFloatParameter.html">ClampedFloatParameter</a> verticalBlur =</div>
<div class="line">        <span class="keyword">new</span> <a class="code hl_class" href="classUnityEngine_1_1Rendering_1_1ClampedFloatParameter.html">ClampedFloatParameter</a>(0.05f, 0, 0.5f);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2283"></a>
<a class="anchor" id="example-shader"></a>The custom shader for the blur effect</h1>
<p>This section contains the code for the custom shader that implements the blur effect.</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line">Shader <span class="stringliteral">&quot;CustomEffects/Blur&quot;</span></div>
<div class="line">{</div>
<div class="line">    HLSLINCLUDE</div>
<div class="line">    </div>
<div class="line"><span class="preprocessor">        #include &quot;Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl&quot;</span></div>
<div class="line">        <span class="comment">// The Blit.hlsl file provides the vertex shader (Vert),</span></div>
<div class="line">        <span class="comment">// the input structure (Attributes), and the output structure (Varyings)</span></div>
<div class="line"><span class="preprocessor">        #include &quot;Packages/com.unity.render-pipelines.core/Runtime/Utilities/Blit.hlsl&quot;</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">float</span> _VerticalBlur;</div>
<div class="line">        <span class="keywordtype">float</span> _HorizontalBlur;</div>
<div class="line">    </div>
<div class="line">        float4 _BlitTexture_TexelSize;</div>
<div class="line">    </div>
<div class="line">        float4 BlurVertical (Varyings input) : SV_Target</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">float</span> BLUR_SAMPLES = 64;</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">float</span> BLUR_SAMPLES_RANGE = BLUR_SAMPLES / 2;</div>
<div class="line">            </div>
<div class="line">            float3 color = 0;</div>
<div class="line">            <span class="keywordtype">float</span> blurPixels = _VerticalBlur * _ScreenParams.y;</div>
<div class="line">            </div>
<div class="line">            <span class="keywordflow">for</span>(<span class="keywordtype">float</span> i = -BLUR_SAMPLES_RANGE; i &lt;= BLUR_SAMPLES_RANGE; i++)</div>
<div class="line">            {</div>
<div class="line">                float2 sampleOffset =</div>
<div class="line">                    float2 (0, (blurPixels / _BlitTexture_TexelSize.w) *</div>
<div class="line">                        (i / BLUR_SAMPLES_RANGE));</div>
<div class="line">                color +=</div>
<div class="line">                    SAMPLE_TEXTURE2D(_BlitTexture, sampler_LinearClamp,</div>
<div class="line">                        input.texcoord + sampleOffset).rgb;</div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line">            <span class="keywordflow">return</span> float4(color.rgb / (BLUR_SAMPLES + 1), 1);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        float4 BlurHorizontal (Varyings input) : SV_Target</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">float</span> BLUR_SAMPLES = 64;</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">float</span> BLUR_SAMPLES_RANGE = BLUR_SAMPLES / 2;</div>
<div class="line">            </div>
<div class="line">            UNITY_SETUP_STEREO_EYE_INDEX_POST_VERTEX(input);</div>
<div class="line">            float3 color = 0;</div>
<div class="line">            <span class="keywordtype">float</span> blurPixels = _HorizontalBlur * _ScreenParams.x;</div>
<div class="line">            <span class="keywordflow">for</span>(<span class="keywordtype">float</span> i = -BLUR_SAMPLES_RANGE; i &lt;= BLUR_SAMPLES_RANGE; i++)</div>
<div class="line">            {</div>
<div class="line">                float2 sampleOffset =</div>
<div class="line">                    float2 ((blurPixels / _BlitTexture_TexelSize.z) *</div>
<div class="line">                        (i / BLUR_SAMPLES_RANGE), 0);</div>
<div class="line">                color +=</div>
<div class="line">                    SAMPLE_TEXTURE2D(_BlitTexture, sampler_LinearClamp,</div>
<div class="line">                        input.texcoord + sampleOffset).rgb;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">return</span> float4(color / (BLUR_SAMPLES + 1), 1);</div>
<div class="line">        }</div>
<div class="line">    </div>
<div class="line">    ENDHLSL</div>
<div class="line">    </div>
<div class="line">    SubShader</div>
<div class="line">    {</div>
<div class="line">        Tags { <span class="stringliteral">&quot;RenderType&quot;</span>=<span class="stringliteral">&quot;Opaque&quot;</span> <span class="stringliteral">&quot;RenderPipeline&quot;</span> = <span class="stringliteral">&quot;UniversalPipeline&quot;</span>}</div>
<div class="line">        LOD 100</div>
<div class="line">        ZWrite Off Cull Off</div>
<div class="line">        Pass</div>
<div class="line">        {</div>
<div class="line">            Name <span class="stringliteral">&quot;BlurPassVertical&quot;</span></div>
<div class="line"> </div>
<div class="line">            HLSLPROGRAM</div>
<div class="line">            </div>
<div class="line"><span class="preprocessor">            #pragma vertex Vert</span></div>
<div class="line"><span class="preprocessor">            #pragma fragment BlurVertical</span></div>
<div class="line">            </div>
<div class="line">            ENDHLSL</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        Pass</div>
<div class="line">        {</div>
<div class="line">            Name <span class="stringliteral">&quot;BlurPassHorizontal&quot;</span></div>
<div class="line"> </div>
<div class="line">            HLSLPROGRAM</div>
<div class="line">            </div>
<div class="line"><span class="preprocessor">            #pragma vertex Vert</span></div>
<div class="line"><span class="preprocessor">            #pragma fragment BlurHorizontal</span></div>
<div class="line">            </div>
<div class="line">            ENDHLSL</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
