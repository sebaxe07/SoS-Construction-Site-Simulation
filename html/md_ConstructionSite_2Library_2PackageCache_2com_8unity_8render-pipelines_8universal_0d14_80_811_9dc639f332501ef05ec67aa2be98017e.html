<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Upgrade custom shaders for URP compatibility</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Upgrade custom shaders for URP compatibility</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md2569"></a></p>
<p>Custom Shaders written for the Built-In Render Pipeline are not compatible with the Universal Render Pipeline (URP), and you can't upgrade them automatically with the Render Pipeline Converter. Instead, you must rewrite the incompatible sections of shader code to work with URP.</p>
<p>You can also recreate custom shaders in Shader Graph. For more information, refer to documentation on <a href="https://docs.unity3d.com/Packages/com.unity.shadergraph@latest">ShaderGraph</a>.</p>
<blockquote class="doxtable">
<p>&zwj;<b>Note</b>: You can identify any materials in a scene that use custom shaders when you upgrade to URP as they turn magenta (bright pink) to indicate an error. </p>
</blockquote>
<p>This guide demonstrates how to upgrade a custom unlit shader from Built-In Render Pipeline to be fully compatible with URP through the following sections:</p>
<ul>
<li>Example Built-In Render Pipeline custom shader</li>
<li>Make the custom shader URP compatible</li>
<li>Enable tiling and offset for the shader</li>
<li>Complete shader code</li>
</ul>
<h1><a class="anchor" id="autotoc_md2570"></a>
Example Built-In Render Pipeline custom shader</h1>
<p>The following shader is a simple unlit shader that works with the Built-In Render Pipeline. This guide demonstrates how to upgrade this shader to be compatible with URP.</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line">Shader <span class="stringliteral">&quot;Custom/UnlitShader&quot;</span></div>
<div class="line">{</div>
<div class="line">    Properties</div>
<div class="line">    {</div>
<div class="line">        [NoScaleOffset] _MainTex(<span class="stringliteral">&quot;Main Texture&quot;</span>, 2D) = <span class="stringliteral">&quot;white&quot;</span> {}</div>
<div class="line">        _Color(<span class="stringliteral">&quot;Color&quot;</span>, Color) = (1,1,1,1)</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    SubShader</div>
<div class="line">    {</div>
<div class="line">        Tags { <span class="stringliteral">&quot;RenderType&quot;</span> = <span class="stringliteral">&quot;Opaque&quot;</span> }</div>
<div class="line"> </div>
<div class="line">        Pass</div>
<div class="line">        {</div>
<div class="line">            CGPROGRAM</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">            #pragma vertex vert</span></div>
<div class="line"><span class="preprocessor">            #pragma fragment frag</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">            #include &quot;UnityCG.cginc&quot;</span></div>
<div class="line"> </div>
<div class="line">            <span class="keyword">struct </span>v2f</div>
<div class="line">            {</div>
<div class="line">                float4 position : SV_POSITION;</div>
<div class="line">                float2 uv: TEXCOORD0;</div>
<div class="line">            };</div>
<div class="line"> </div>
<div class="line">            float4 _Color;</div>
<div class="line">            sampler2D _MainTex;</div>
<div class="line"> </div>
<div class="line">            v2f vert(appdata_base v)</div>
<div class="line">            {</div>
<div class="line">                v2f o;</div>
<div class="line"> </div>
<div class="line">                o.position = UnityObjectToClipPos(v.vertex);</div>
<div class="line">                o.uv = v.texcoord;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">return</span> o;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            fixed4 frag(v2f i) : SV_Target</div>
<div class="line">            {</div>
<div class="line">                fixed4 texel = tex2D(_MainTex, i.uv);</div>
<div class="line">                <span class="keywordflow">return</span> texel * _Color;</div>
<div class="line">            }</div>
<div class="line">            ENDCG</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2571"></a>
Make the custom shader URP compatible</h1>
<p>Built-In Render Pipeline shaders have two issues, which you can see in the Inspector window:</p>
<ul>
<li>A warning that <b>Material property is found in another cbuffer</b>.</li>
<li>The <b>SRP Batcher</b> property displays <b>not compatible</b>.</li>
</ul>
<p>The following steps show how to solve these issues and make a shader compatible with URP and the SRP Batcher.</p>
<ol type="1">
<li>Change <code>CGPROGRAM</code> and <code>ENDCG</code> to <code>HLSLPROGRAM</code> and <code>ENDHLSL</code>.</li>
<li><p class="startli">Update the include statement to reference the <code>Core.hlsl</code> file.</p>
<div class="fragment"><div class="line">++</div>
<div class="line"><span class="preprocessor">   #include &quot;Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl&quot;</span></div>
</div><!-- fragment --><p class="startli">&gt; <b>Note</b>: <code>Core.hlsl</code> includes the core SRP library, URP shader variables, and matrix defines and transformations, but it does not include lighting functions or default structs.</p>
</li>
<li><p class="startli">Add <code>"RenderPipeline" = "UniversalPipeline"</code> to the shader tags.</p>
<div class="fragment"><div class="line">++</div>
<div class="line">   Tags { <span class="stringliteral">&quot;RenderType&quot;</span> = <span class="stringliteral">&quot;Opaque&quot;</span> <span class="stringliteral">&quot;RenderPipeline&quot;</span> = <span class="stringliteral">&quot;UniversalPipeline&quot;</span> }</div>
</div><!-- fragment --><p class="startli">&gt; <b>Note</b>: URP does not support all ShaderLab tags. For more information on which tags URP supports, refer to <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8render-pipelines_8universal_0d14_80_811_533dd7cdc58857cbfbc5d3c930cbfae5.html">URP ShaderLab Pass tags</a>.</p>
</li>
<li><p class="startli">Replace the <code>struct v2f</code> code block with the following <code>struct Varyings</code> code block. This changes the struct to use the URP naming convention of <code>Varyings</code> instead of <code>v2f</code>, and updates the shader to use the correct variables for URP.</p>
<div class="fragment"><div class="line">++</div>
<div class="line">   <span class="keyword">struct </span>Varyings</div>
<div class="line">   {</div>
<div class="line">       <span class="comment">// The positions in this struct must have the SV_POSITION semantic.</span></div>
<div class="line">       float4 positionHCS  : SV_POSITION;</div>
<div class="line">       float2 uv : TEXCOORD0;</div>
<div class="line">   };</div>
</div><!-- fragment --></li>
<li>Beneath the include statement and above the <code>Varyings</code> struct, define a new struct with the name <code>Attributes</code>. This is equivalent to the Built-In Render Pipeline's appdata structs but with the new URP naming conventions.</li>
<li><p class="startli">Add the variables shown below to the <code>Attributes</code> struct.</p>
<div class="fragment"><div class="line">++</div>
<div class="line">   <span class="keyword">struct </span>Attributes</div>
<div class="line">   {</div>
<div class="line">       float4 positionOS   : POSITION;</div>
<div class="line">       float2 uv : TEXCOORD0;</div>
<div class="line">   };</div>
</div><!-- fragment --></li>
<li><p class="startli">Update the <code>v2f vert</code> function definition to use the new <code>Varyings</code> struct and take an instance of the <code>Attributes</code> struct as an input, as shown below.</p>
<div class="fragment"><div class="line">++</div>
<div class="line">   Varyings vert(Attributes IN)</div>
</div><!-- fragment --></li>
<li><p class="startli">Update the vert function to output an instance of the <code>Varyings</code> struct and use the <code>TransformObjectToHClip</code> function to convert from object space to clip space. The function also needs to take the input <code>Attributes</code> UV and pass it to the output <code>Varyings</code> UV.</p>
<div class="fragment"><div class="line">++</div>
<div class="line">   Varyings vert(Attributes IN)</div>
<div class="line">   {</div>
<div class="line">       Varyings OUT;</div>
<div class="line"> </div>
<div class="line">       OUT.positionHCS = TransformObjectToHClip(IN.positionOS.xyz);</div>
<div class="line">       OUT.uv = IN.uv;</div>
<div class="line"> </div>
<div class="line">       <span class="keywordflow">return</span> OUT;</div>
<div class="line">   }</div>
</div><!-- fragment --><p class="startli">&gt; <b>Note</b>: URP shaders use suffixes to indicate the space. <code>OS</code> means object space, and <code>HCS</code> means homogeneous clip space.</p>
</li>
<li><p class="startli">Place a <code>CBUFFER</code> code block around the properties the shader uses, along with the <code>UnityPerMaterial</code> parameter.</p>
<div class="fragment"><div class="line">++</div>
<div class="line">   CBUFFER_START(UnityPerMaterial)</div>
<div class="line">   float4 _Color;</div>
<div class="line">   sampler2D _MainTex;</div>
<div class="line">   CBUFFER_END</div>
</div><!-- fragment --><p class="startli">&gt; <b>Note</b>: For a shader to be SRP Batcher compatible, you must declare all material properties within a <code>CBUFFER</code> code block. Even if a shader has multiple passes, all passes must use the same <code>CBUFFER</code> block.</p>
</li>
<li><p class="startli">Update the <code>frag</code> function to use the <code>Varyings</code> input and the type <code>half4</code>, as shown below. The <code>frag</code> function must now use this type, as URP shaders do not support fixed types.</p>
<p class="startli"><code>c++ half4 frag(Varyings IN) : SV_Target { half4 texel = tex2D(_MainTex, IN.uv); return texel * _Color; } </code></p>
</li>
</ol>
<p>This custom unlit shader is now compatible with the SRP Batcher and ready for use within URP. You can check this in the Inspector window:</p>
<ul>
<li>The warning that <b>Material property is found in another cbuffer</b> no longer appears.</li>
<li>The <b>SRP Batcher</b> property displays <b>compatible</b>.</li>
</ul>
<h1><a class="anchor" id="autotoc_md2572"></a>
Enable tiling and offset for the shader</h1>
<p>Although the shader is now compatible with URP and the SRP Batcher, you can't use use the <b>Tiling</b> and <b>Offset</b> properties without further changes. To add this functionality to the custom unlit shader, use the following steps.</p>
<ol type="1">
<li>Rename the property <code>_MainTex</code> to <code>_BaseMap</code> along with any references to this property. This brings the shader code closer to standard URP shader conventions.</li>
<li>Remove the <code>[NoScaleOffset]</code> ShaderLab attribute from the <code>_BaseMap</code> property. You can now see <b>Tiling</b> and <b>Offset</b> properties in the shader's Inspector window.</li>
<li><p class="startli">Add the <code>[MainTexture]</code> ShaderLab attribute to the <code>_BaseMap</code> property and the <code>[MainColor]</code> attribute to the <code>_Color</code> property. This tells the Editor which property to return when you request the main texture or main color from another part of your project or in the Editor. The <code>Properties</code> section of your shader should now look as follows:</p>
<div class="fragment"><div class="line">++</div>
<div class="line">   Properties</div>
<div class="line">   {</div>
<div class="line">       [MainTexture] _BaseMap(<span class="stringliteral">&quot;Main Texture&quot;</span>, 2D) = <span class="stringliteral">&quot;white&quot;</span> {}</div>
<div class="line">       [MainColor] _Color(<span class="stringliteral">&quot;Color&quot;</span>, Color) = (1,1,1,1)</div>
<div class="line">   }</div>
</div><!-- fragment --></li>
<li><p class="startli">Add the <code>TEXTURE2D(_BaseMap)</code> and <code>SAMPLER(sampler_BaseMap)</code> macros above the <code>CBUFFER</code> block. These macros define the texture and sampler state variables for use later. For more information on sampler states, refer to [Using sampler states](xref:SL-SamplerStates).</p>
<div class="fragment"><div class="line">++</div>
<div class="line">   TEXTURE2D(_BaseMap);</div>
<div class="line">   SAMPLER(sampler_BaseMap);</div>
</div><!-- fragment --></li>
<li><p class="startli">Change the <code>sampler2D _BaseMap</code> variable inside the <code>CBUFFER</code> block to <code>float4 _BaseMap_ST</code>. This variable now stores the tiling and offset values set in the Inspector.</p>
<div class="fragment"><div class="line">++</div>
<div class="line">   CBUFFER_START(UnityPerMaterial)</div>
<div class="line">   float4 _Color;</div>
<div class="line">   float4 _BaseMap_ST;</div>
<div class="line">   CBUFFER_END</div>
</div><!-- fragment --></li>
<li><p class="startli">Change the <code>frag</code> function to access the texture with a macro instead of <code>tex2D</code> directly. To do this, replace <code>tex2D</code> with the <code>SAMPLE_TEXTURE2D</code> macro and add <code>sampler_BaseMap</code> as an additional parameter, as shown below:</p>
<div class="fragment"><div class="line">++</div>
<div class="line">   half4 frag(Varyings IN) : SV_Target</div>
<div class="line">   {</div>
<div class="line">       half4 texel = SAMPLE_TEXTURE2D(_BaseMap, sampler_BaseMap, IN.uv);</div>
<div class="line">       <span class="keywordflow">return</span> texel * _Color;</div>
<div class="line">   }</div>
</div><!-- fragment --></li>
<li><p class="startli">In the <code>vert</code> function, change <code>OUT.uv</code> to use a macro instead of passing the texture coordinates as <code>IN.uv</code> directly. To do this, replace <code>IN.uv</code> with <code>TRANSFORM_TEX(IN.uv, _BaseMap)</code>. Your <code>vert</code> function should now look like the following example:</p>
<div class="fragment"><div class="line">++</div>
<div class="line">   Varyings vert(Attributes IN)</div>
<div class="line">   {</div>
<div class="line">       Varyings OUT;</div>
<div class="line"> </div>
<div class="line">       OUT.positionHCS = TransformObjectToHClip(IN.positionOS.xyz);</div>
<div class="line">       OUT.uv = TRANSFORM_TEX(IN.uv, _BaseMap);</div>
<div class="line"> </div>
<div class="line">       <span class="keywordflow">return</span> OUT;</div>
<div class="line">   }</div>
</div><!-- fragment --><p class="startli">&gt; <b>Note</b>: It's important that you define the <code>vert</code> function after the <code>CBUFFER</code> block, as the <code>TRANSFORM_TEX</code> macro uses the parameter with the <code>_ST</code> suffix.</p>
</li>
</ol>
<p>This shader now has a texture, modified by a color, and is fully SRP Batcher compatible. It also fully supports the <b>Tiling</b> and <b>Offset</b> properties.</p>
<p>To see an example of the complete shader code, refer to the Complete shader code section of this page.</p>
<h1><a class="anchor" id="autotoc_md2573"></a>
Complete shader code</h1>
<div class="fragment"><div class="line"> ++</div>
<div class="line">Shader <span class="stringliteral">&quot;Custom/UnlitShader&quot;</span></div>
<div class="line">{</div>
<div class="line">    Properties</div>
<div class="line">    {</div>
<div class="line">        _BaseMap(<span class="stringliteral">&quot;Base Map&quot;</span>, 2D) = <span class="stringliteral">&quot;white&quot;</span> {}</div>
<div class="line">        _Color(<span class="stringliteral">&quot;Color&quot;</span>, Color) = (1,1,1,1)</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    SubShader</div>
<div class="line">    {</div>
<div class="line">        Tags { <span class="stringliteral">&quot;RenderType&quot;</span> = <span class="stringliteral">&quot;Opaque&quot;</span> <span class="stringliteral">&quot;RenderPipeline&quot;</span> = <span class="stringliteral">&quot;UniversalPipeline&quot;</span> }</div>
<div class="line"> </div>
<div class="line">        Pass</div>
<div class="line">        {</div>
<div class="line">            HLSLPROGRAM</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">            #pragma vertex vert</span></div>
<div class="line"><span class="preprocessor">            #pragma fragment frag</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">            #include &quot;Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl&quot;</span></div>
<div class="line"> </div>
<div class="line">            <span class="keyword">struct </span>Attributes</div>
<div class="line">            {</div>
<div class="line">                float4 positionOS   : POSITION;</div>
<div class="line">                float2 uv: TEXCOORD0;</div>
<div class="line">            };</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">struct </span>Varyings</div>
<div class="line">            {</div>
<div class="line">                float4 positionCS  : SV_POSITION;</div>
<div class="line">                float2 uv: TEXCOORD0;</div>
<div class="line">            };</div>
<div class="line"> </div>
<div class="line">            TEXTURE2D(_BaseMap);</div>
<div class="line">            SAMPLER(sampler_BaseMap);</div>
<div class="line"> </div>
<div class="line">            CBUFFER_START(UnityPerMaterial)</div>
<div class="line">            float4 _Color;</div>
<div class="line">            float4 _BaseMap_ST;</div>
<div class="line">            CBUFFER_END</div>
<div class="line"> </div>
<div class="line">            Varyings vert(Attributes IN)</div>
<div class="line">            {</div>
<div class="line">                Varyings OUT;</div>
<div class="line"> </div>
<div class="line">                OUT.positionCS = TransformObjectToHClip(IN.positionOS.xyz);</div>
<div class="line">                OUT.uv = TRANSFORM_TEX(IN.uv, _BaseMap);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">return</span> OUT;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            half4 frag(Varyings IN) : SV_Target</div>
<div class="line">            {</div>
<div class="line">                float4 texel = SAMPLE_TEXTURE2D(_BaseMap, sampler_BaseMap, IN.uv);</div>
<div class="line">                <span class="keywordflow">return</span> texel * _Color;</div>
<div class="line">            }</div>
<div class="line">            ENDHLSL</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
