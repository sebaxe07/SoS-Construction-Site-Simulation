<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Introduction to the 2D Lighting system</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Introduction to the 2D Lighting system</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md2076"></a></p>
<p>The 2D Lighting system included with URP consists of a set of artist friendly tools and runtime components that help you quickly create a lit 2D Scene through core <a class="el" href="namespaceUnity.html">Unity</a> components such as the <a href="https://docs.unity3d.com/Manual/class-SpriteRenderer.html">Sprite Renderer</a>, and 2D Light components that act as 2D counterparts to familiar 3D Light components.</p>
<p>These tools are designed to integrate seamlessly with 2D Renderers such as the <a href="https://docs.unity3d.com/Manual/Sprites.html">Sprite Renderer</a>, <a href="https://docs.unity3d.com/Manual/class-Tilemap.html">Tilemap Renderer</a>, and <a href="https://docs.unity3d.com/Manual/class-SpriteShapeRenderer.html">Sprite Shape Renderer</a>. This system of tools and components are optimized for mobile systems, and for running on multiple platforms.</p>
<h1><a class="anchor" id="autotoc_md2077"></a>
Differences from 3D Lights</h1>
<p>There are a number of key differences between the implementation and behavior of 2D Lights and 3D Light, which consists of the following:</p>
<h2><a class="anchor" id="autotoc_md2078"></a>
New 2D specific components and render pass</h2>
<p>The 2D lighting systems includes its own set of 2D Light components, <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8render-pipelines_8universal_0d14_80_811_2Documentation_0i_2ShaderGraph.html">Shader Graph</a> sub-targets and a custom 2D render pass that are specifically designed for 2D lighting and rendering. Editor tooling for the 2D Lights and pass configuration are also included in the package.</p>
<h2><a class="anchor" id="autotoc_md2079"></a>
Coplanar</h2>
<p>The 2D lighting model was designed specifically to work with 2D worlds that are coplanar and multi-layered. A 2D Light does not require depth separation between it and the object it is lighting. The 2D shadow system also works in coplanar and does not require depth separation.</p>
<h2><a class="anchor" id="autotoc_md2080"></a>
Not physically based</h2>
<p>The lighting calculation in 2D Lights is not physics based as it is with 3D Lights. The details of the lighting model calculation can be found here.</p>
<h2><a class="anchor" id="autotoc_md2081"></a>
No interoperability with 3D Lights and 3D Renderers</h2>
<p>3D and 2D Lights can only affect 3D and 2D Renderers respectively. 2D Lighting does not work on or effect 3D Renderers such as the <a href="https://docs.unity3d.com/Manual/class-MeshRenderer.html">Mesh Renderer</a>, while 3D Lighting will similarly have no effect on 2D Renderers such as the <a href="https://docs.unity3d.com/Manual/class-SpriteRenderer.html">Sprite Renderer</a>. Currently, to achieve a combination of 2D and 3D Lights and 2D and 3D Renderers in a single Scene, you can use multiple cameras and have one of the cameras render to a <a href="https://docs.unity3d.com/Manual/class-RenderTexture.html">Render Texture</a>, and sample that texture in a material rendered by another camera.</p>
<h1><a class="anchor" id="autotoc_md2082"></a>
Technical details of the 2D Lighting graphics pipeline</h1>
<p>The 2D Lighting graphics pipeline rendering process can be broken down into 2 distinct phases: 1) Drawing the Light Render Textures 2) Drawing the Renderers</p>
<p>Light Render Textures are <a href="https://docs.unity3d.com/Manual/class-RenderTexture.html">Render Textures</a> that contain information about the Light’s color and shape in screen space.</p>
<p>These two phases are only repeated for each distinctly lit set of Light Layers. In other words, if <a href="https://docs.unity3d.com/Manual/class-TagManager.html#SortingLayers">Sorting Layers</a> 1 through 4 have the exact same set of Lights, it will only perform the above set of operations once.</p>
<p>The default setup allows a number of <a href="https://docs.unity3d.com/Manual/DrawCallBatching.html">batches</a> to be drawn ahead of time before drawing the Renderers to reduce target switching. The ideal setup would allow the pipeline to render the Light Render Textures for all the batches and only then move on to draw the Renderers. This prevents loading and unloading of the color target. Refer to Optimization for more detailed information.</p>
<h2><a class="anchor" id="autotoc_md2083"></a>
<a class="anchor" id="pre-phase"></a>Pre-phase: Calculate Sorting Layer batching</h2>
<p>Before proceeding with the rendering phases, the 2D Lighting graphics pipeline first analyses the Scene to assess which Layers can be batched together in a single draw operation. The following is the criteria that determine whether Layers are batched together:</p><ol type="1">
<li>They are consecutive Layers.</li>
<li>They share the exact same set of Lights.</li>
</ol>
<p>It is highly recommended to batch as many Layers as possible to minimize the number of Light Render Textures draw operations and improve performance.</p>
<h2><a class="anchor" id="autotoc_md2084"></a>
Phase 1: Draw Light Render Textures</h2>
<p>After the pre-phase batching, the pipeline then draws the Light Textures for that batch. This essentially draws the Light’s shape onto a Render Texture. The light’s color and shape can be blended onto the target Light Render Texture using Additive or Alpha Blended depending on the light’s setup.</p>
<p><img src="Images/2D/introduction_phase1.png" alt="" class="inline"/></p>
<p>It is worth noting that a Light Render Texture is only created when at least one 2D Light is targeting it. For example, if all the lights of a Layer only uses <b>Blendstyle #1</b>, then only one Light Render Texture is created.</p>
<h2><a class="anchor" id="autotoc_md2085"></a>
Phase 2: Draw Renderers</h2>
<p>Once all the Light Render Textures have been drawn, the pipeline proceeds to draw the Renderers. The system will keep track of which set of Renderers are drawn by which set of Light Render Textures. They are associated during the batching process in the pre-phase.</p>
<p>When the Renderers are being drawn, it will have access to all (one for each blend style) the available Light Render Textures. In the shader, the final color is calculated by combining the input color with colors from the Light Render Texture using the specified operation.</p>
<p><img src="Images/2D/introduction_phase2.png" alt="" class="inline"/></p>
<p>An example of a setup with four active blend styles illustrating how multiple blend styles come together. In most cases, you would typically only need two blend styles for your desired effect.</p>
<h1><a class="anchor" id="autotoc_md2086"></a>
Optimization</h1>
<p>In addition to the standard optimization techniques such as reducing draw calls, culling and optimizing shaders, there are several techniques and considerations that are unique to the 2D Lighting graphics pipeline.</p>
<h2><a class="anchor" id="autotoc_md2087"></a>
Number of blend styles</h2>
<p>The easiest way to increase rendering performance is to reduce the number of blend styles used. Each blend style is a Render Texture that needs to be rendered and subsequently uploaded.</p>
<p>Reducing the number of blend styles has a direct impact on the performance. For simple scenes a single blend style could suffice. It is also common to use up to 2 blend styles in a scene.</p>
<h2><a class="anchor" id="autotoc_md2088"></a>
Light Render Texture scale</h2>
<p>The 2D Lighting system relies on screen space Light Render Texture to capture light contribution. This means there are a lot of Render Texture drawing subsequent uploading. Choosing the right Render Texture size directly impacts the performance.</p>
<p>By default it is set at 0.5x of screen resolution. Smaller Light Render Texture size will give better performance at the cost of visual artifact. Half screen size resolution provides a good performance with almost no noticeable artifact in most situations.</p>
<p>Experiment and find a scale suitable for your project.</p>
<h2><a class="anchor" id="autotoc_md2089"></a>
Layer Batching</h2>
<p>To further reduce the number of Light Render Textures, it is crucial to make the Sorting Layer batchable. Layers that are batched together share the same set of Light Render Textures. Uniquely lit layers will have its own set thus increasing the amount of work needed.</p>
<p>Layers can be batch together if they share the same set of lights.</p>
<h2><a class="anchor" id="autotoc_md2090"></a>
Pre-rendering of Light Render Texture</h2>
<p>Multiple sets of Light Render Textures can be rendered ahead of drawing the Renderers. In an ideal situation, all the Light Render Textures will be rendered upfront and only then will the pipeline proceed with drawing the Renderers onto the final color output. This reduces the need to load/unload/reload of final color output.</p>
<p>In a very complex setup with many distinctly lit Layers, it may not be practical to pre-render all Light Render Textures. The limit can be configured in the 2D Renderer Data inspector.</p>
<h2><a class="anchor" id="autotoc_md2091"></a>
Normal Maps</h2>
<p>Using normal maps to simulate depth is currently a very expensive operation. If it is enabled, a full size Render Texture is created during a depth pre-pass and the Renderers are drawn onto it. This is done for each Layer batch.</p>
<p>If the normal mapping effect to simulate depth perception is not needed, ensure that all lights have the normal map option disabled. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
