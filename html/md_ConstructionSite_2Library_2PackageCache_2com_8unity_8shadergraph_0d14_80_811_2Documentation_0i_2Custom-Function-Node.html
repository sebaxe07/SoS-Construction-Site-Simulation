<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Custom Function Node</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Custom Function Node</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md3068"></a></p>
<p><img src="images/Custom-Function-Node.png" alt="01" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md3069"></a>
Description</h1>
<p>The Custom Function Node enables you to inject your own custom HLSL code in Shader Graphs. This provides you with an extra level of control when you need it (for example, to do some fine-grained optimization). You can either write small functions directly into graphs by using the string mode, or reference external HLSL include files. Use the <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8shadergraph_0d14_80_811_2Documentation_0i_2Custom-Port-Menu.html">Custom Port Menu</a> to define your own input and output ports on the node itself.</p>
<h1><a class="anchor" id="autotoc_md3070"></a>
How to Use</h1>
<p>Use the <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8shadergraph_0d14_80_811_2Documentation_0i_2Create-Node-Menu.html">Create Node Menu</a> to create Custom Function nodes. By default, new Custom Function nodes don't have any input or output ports. In the <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8shadergraph_0d14_80_811_2Documentation_0i_2Internal-Inspector.html">Graph Inspector</a>, open the <b>Node Settings</b> to access the Custom Function and <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8shadergraph_0d14_80_811_2Documentation_0i_2Custom-Port-Menu.html">Custom Port Menu</a> menus.</p>
<p><img src="images/Custom-Function-Node-File.png" alt="02" class="inline"/> <img src="images/Custom-Function-Node-String.png" alt="03" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md3071"></a>
Custom Function menu</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Menu Item   </th><th class="markdownTableHeadLeft">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Inputs   </td><td class="markdownTableBodyLeft">A <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8shadergraph_0d14_80_811_2Documentation_0i_2Custom-Port-Menu.html">Custom Port Menu</a> that defines the node's input ports.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Outputs   </td><td class="markdownTableBodyLeft">A <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8shadergraph_0d14_80_811_2Documentation_0i_2Custom-Port-Menu.html">Custom Port Menu</a> that defines the node's input ports.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Type   </td><td class="markdownTableBodyLeft">A function type selector. Choose File to reference an external file or string to directly input functions to the node.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Name   </td><td class="markdownTableBodyLeft">Part of the name this custom function has in the final generated code. Suffixed by the function type <code>_half</code> or <code>_float</code>.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Source   </td><td class="markdownTableBodyLeft">An asset field to reference the external HLSL include file. <b>Only available in <code>File</code> mode</b>.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Body   </td><td class="markdownTableBodyLeft">A text box where you enter HLSL code. <b>Only available in <code>String</code> mode</b>.   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md3072"></a>
Defining the Function via string</h2>
<p>If you select <code>String</code> mode, the graph generates the shader function. The <code>Name</code> field defines the name of the generated function, and the <code>Body</code> field defines the contents of the generated function. <a class="el" href="namespaceUnity.html">Unity</a> handles the arguments, braces, and indent scope automatically. In <code>String</code> mode you may use the token <code>$precision</code> instead of <code>half</code> or <code>float</code> in the <code>Body</code> field. <a class="el" href="namespaceUnity.html">Unity</a> replaces this with the correct type, based on that node's precision, when the node is processed.</p>
<p><img src="images/Custom-Function-Node-String-wFunction.png" alt="04" class="inline"/></p>
<p>The example in the image above generates the following function:</p>
<div class="fragment"><div class="line">void MyFunction_float(float3 A, float B, out float3 Out)</div>
<div class="line">{</div>
<div class="line">    Out  =  A + B + 1/2;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3073"></a>
Defining the Function via file</h2>
<p>If you select <code>File</code> mode, the graph does not automatically generate the shader function. This mode injects an include reference in the final generated shader, and uses a function from within the referenced file. The <code>Name</code> field must match the name of the function you wish to call. The <code>Source</code> field contains a reference to the HLSL file that includes the function.</p>
<p><img src="images/Custom-Function-Node-File-wFunction.png" alt="06" class="inline"/></p>
<p>When you use <code>File</code> mode for the Custom Function node, you must manually format the functions properly. One thing to note when creating custom functions for <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8shadergraph_0d14_80_811_2Documentation_0i_2index.html">Shader Graph</a> is the precision suffixes. The generated code appends a precision suffix to function names. Your include file function must also append your desired precision suffix (shown below with <code>_float</code>), or contain multiple functions with both <code>_float</code> and <code>_half</code> suffixes, but your <code>Name</code> field <b>must not include the precision suffix</b>.</p>
<div class="fragment"><div class="line">//UNITY_SHADER_NO_UPGRADE</div>
<div class="line">#ifndef MYHLSLINCLUDE_INCLUDED</div>
<div class="line">#define MYHLSLINCLUDE_INCLUDED</div>
<div class="line"> </div>
<div class="line">void MyFunction_float(float3 A, float B, out float3 Out)</div>
<div class="line">{</div>
<div class="line">    Out = A + B;</div>
<div class="line">}</div>
<div class="line">#endif //MYHLSLINCLUDE_INCLUDED</div>
</div><!-- fragment --><p><code>File</code> mode allows for more flexbility with custom functions in a graph. You can define uniform variables outside of the function scope, as shown here with a matrix.</p>
<div class="fragment"><div class="line">//UNITY_SHADER_NO_UPGRADE</div>
<div class="line">#ifndef MYHLSLINCLUDE_INCLUDED</div>
<div class="line">#define MYHLSLINCLUDE_INCLUDED</div>
<div class="line">float4x4 _MyMatrix;</div>
<div class="line">void MyFunction_float(float3 A, float B, out float3 Out)</div>
<div class="line">{</div>
<div class="line">    A = mul(float4(A, 0.0), _MyMatrix).rgb;</div>
<div class="line">Out = A + B;</div>
<div class="line">}</div>
<div class="line">#endif //MYHLSLINCLUDE_INCLUDED</div>
</div><!-- fragment --><p>You can define multiple functions in the same file, and call them from your referenced function. Alternatively, you can reference the same file, but use different functions from different Custom Function nodes.</p>
<div class="fragment"><div class="line">//UNITY_SHADER_NO_UPGRADE</div>
<div class="line">#ifndef MYHLSLINCLUDE_INCLUDED</div>
<div class="line">#define MYHLSLINCLUDE_INCLUDED</div>
<div class="line">float3 MyOtherFunction_float(float3 In)</div>
<div class="line">{</div>
<div class="line">    return In * In;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void MyFunction_float(float3 A, float B, out float3 Out)</div>
<div class="line">{</div>
<div class="line">    A = MyOtherFunction_float(A);</div>
<div class="line">    Out = A + B;</div>
<div class="line">}</div>
<div class="line">#endif //MYHLSLINCLUDE_INCLUDED</div>
</div><!-- fragment --><p>You can even include other files that contain other functions.</p>
<div class="fragment"><div class="line">//UNITY_SHADER_NO_UPGRADE</div>
<div class="line">#ifndef MYHLSLINCLUDE_INCLUDED</div>
<div class="line">#define MYHLSLINCLUDE_INCLUDED</div>
<div class="line">#include &quot;Assets/MyOtherInclude.hlsl&quot;</div>
<div class="line">void MyFunction_float(float3 A, float B, out float3 Out)</div>
<div class="line">{</div>
<div class="line">    A = MyOtherFunction_float(A);</div>
<div class="line">    Out = A + B;</div>
<div class="line">}</div>
<div class="line">#endif //MYHLSLINCLUDE_INCLUDED</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3074"></a>
Reusing Custom Function Nodes</h2>
<p>The Custom Function node, on its own, is a single node instance. If you wish to re-use the same custom functions without re-creating the inputs, outputs, and function referencing, use <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8shadergraph_0d14_80_811_2Documentation_0i_2Sub-graph.html">Sub Graphs</a>. Sub Graphs appear in the <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8shadergraph_0d14_80_811_2Documentation_0i_2Create-Node-Menu.html">Create Node Menu</a>, and they enable you to share or re-use your custom functions.</p>
<p><img src="images/Custom-Function-Node-Subgraph.png" alt="11" class="inline"/></p>
<p>Create your custom function either directly in a Sub Graph, or right-click the existing Custom Function node and select <code>Convert to Sub Graph</code>. To add the appropriate input and output ports, use the <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8shadergraph_0d14_80_811_2Documentation_0i_2Internal-Inspector.html">Graph Inspector</a> and <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8shadergraph_0d14_80_811_2Documentation_0i_2Custom-Port-Menu.html">Custom Port Menu</a>. After this, you can reuse your custom function as many times as needed, even within other Sub Graphs.</p>
<h2><a class="anchor" id="autotoc_md3075"></a>
Working with texture wires</h2>
<p>From version 10.3, Shader Graph has five new data structures to ensure that Custom Function Nodes (CFNs) and SubGraphs input and output data from texture wires in a consistent way. The new structures also make it possible for SamplerState to compile on <a href="https://en.wikipedia.org/wiki/OpenGL_ES#OpenGL_ES_2.0">GLES2</a> platforms and access data associated with textures via <code>myInputTex.samplerstate</code> and <code>myInputTex.texelSize</code>.</p>
<p>Four structures are for the texture types, and one is for the sampler state:</p>
<ul>
<li>UnityTexture2D</li>
<li>UnityTexture2DArray</li>
<li>UnityTexture3D</li>
<li>UnityTextureCube</li>
<li>UnitySamplerState</li>
</ul>
<p>CFNs you create with earlier versions of Shader Graph continue to work after this change. As part of the automatic update, <a class="el" href="namespaceUnity.html">Unity</a> transitions them to the new <b>Bare</b> node type. This type replicates the old input and output behavior. All other types pass the new structs.</p>
<p>However, you should manually upgrade CFNs that produce texture or samplerstate types as output to ensure that they behave consistently—and to gain the benefits of the new design. <a class="el" href="namespaceUnity.html">Unity</a> flags this type of outdated Custom Function Nodes with a warning when you open your Shader Graph in 10.3 or later.</p>
<h3><a class="anchor" id="autotoc_md3076"></a>
How to upgrade</h3>
<ol type="1">
<li>Change all of the input and output types from <b>Bare</b> to <b>non-Bare</b>.<br  />
</li>
</ol>
<ul>
<li><b>String</b> type: Ensure that your HLSL string already uses <a class="el" href="namespaceUnity.html">Unity</a>'s texture access macros (such as <code>SAMPLE_TEXTURE2D</code>).</li>
<li><b>File</b> type: Replace Bare types (such as Texture2D) with the new struct types (such as UnityTexture2D) in your function parameters.</li>
</ul>
<ol type="1">
<li>If your HLSL code is using platform-specific or non-standard texture operations, you'll need to convert the way you access textures to take that structure into account. For example, <code>myInputTex.GetDimensions(...)</code> would become <code>myInputTex.tex.GetDimensions(...)</code></li>
</ol>
<p>From version 10.3, you can access data associated with textures via <code>myInputTex.samplerstate</code> and <code>myInputTex.texelSize</code>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
