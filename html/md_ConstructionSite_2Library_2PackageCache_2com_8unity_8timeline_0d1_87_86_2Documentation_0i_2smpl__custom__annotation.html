<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Annotation marker sample</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Annotation marker sample</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md5238"></a></p>
<p>The Annotation sample provides a marker that can be used as a bookmark for your timeline.</p>
<p><img src="images/smpl_annotation.png" alt="Annotation" class="inline"/></p>
<p>Here are the options available on an annotation: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Field   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Title   </td><td class="markdownTableBodyNone">The annotation's title. This will be displayed as a tooltip, when hovering the mouse on the annotation.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Color   </td><td class="markdownTableBodyNone">The annotation's color in the <a class="el" href="namespaceTimeline.html">Timeline</a> window.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Show line overlay   </td><td class="markdownTableBodyNone">Use this option to show a vertical line that spans the full height of the <a class="el" href="namespaceTimeline.html">Timeline</a> window.   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md5239"></a>
Custom marker workflow example</h1>
<p>This example will demonstrate how to:</p>
<ul>
<li>create a custom marker;</li>
<li>customize a marker with <code>MarkerEditor</code>;</li>
<li>use a custom USS style to draw a marker;</li>
<li>add additional commands with <code>Actions</code>;</li>
</ul>
<h2><a class="anchor" id="autotoc_md5240"></a>
1. Create an annotation marker</h2>
<p>A marker is an item that can be added to a <a class="el" href="namespaceTimeline.html">Timeline</a> Asset and is used to represent a point in time. Markers also have a specialization, just like clips (Activation clip, Audio clip, Animation clip, etc).</p>
<p>In order to add a new type of marker, all we need to do is to create a class that inherits the <code>Marker</code> class:</p>
<div class="fragment"><div class="line"> c#</div>
<div class="line">public class AnnotationMarker : UnityEngine.Timeline.Marker {}</div>
</div><!-- fragment --><p>This custom marker can now be added to any track or on the timeline marker area:</p>
<p><img src="images/smpl_annotation_newMarker.png" alt="New marker added to a timeline" class="inline"/></p>
<p>We can add a title, description and color to the annotation:</p>
<div class="fragment"><div class="line"> c#</div>
<div class="line">public class AnnotationMarker : Marker</div>
<div class="line">{</div>
<div class="line">    public string title;</div>
<div class="line">    public Color color;</div>
<div class="line">    public string description;</div>
<div class="line">    public bool showLineOverlay;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The annotation marker itself is now complete. But the customization work is not done yet. <a class="el" href="namespaceTimeline.html">Timeline</a> offers many customization abilities.</p>
<h1><a class="anchor" id="autotoc_md5241"></a>
2. Customize the marker's appearance</h1>
<p>A marker's appearance can be customized using a USS style or with <code>MarkerEditor</code>. Both paths have their advantages and drawbacks.</p>
<h2><a class="anchor" id="autotoc_md5242"></a>
Custom USS style</h2>
<p>A marker can use a USS style to specify its appearance. For more information on how to create custom USS styles, see <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8timeline_0d1_87_86_2Documentation_0i_2uss__styles.html">how to define custom USS styles</a>.</p>
<p>The <a href="xref:UnityEngine.Timeline.CustomStyleAttribute">CustomStyle</a> attribute can be used to specify a style for a given marker:</p>
<div class="fragment"><div class="line"> c#</div>
<div class="line">[CustomStyle(&quot;AnnotationStyle&quot;)]</div>
<div class="line">public class AnnotationMarker : Marker</div>
<div class="line">{</div>
<div class="line">    //...</div>
<div class="line">}</div>
</div><!-- fragment --><p><code>AnnotationStyle</code> is defined in a USS stylesheet and will be used when a marker is displayed on screen:</p>
<p><img src="images/smpl_annotation_customStyle.png" alt="Custom style" class="inline"/></p>
<p>USS styles are useful if the desired appearance is simple (i.e. when only using a texture icon). For more complex stuff (i.e. dynamically changing a marker's color), a <code>MarkerEditor</code> will be needed.</p>
<h2><a class="anchor" id="autotoc_md5243"></a>
Custom editor</h2>
<p><code>MarkerEditor</code> can be used to augment the capabilities of a marker in the editor. It works like a custom <a href="https://docs.unity3d.com/ScriptReference/CustomEditor.html">Inspector</a>; the <a href="xref:UnityEditor.Timeline.CustomTimelineEditorAttribute">CustomTimelineEditor attribute</a> is used to tell <a class="el" href="namespaceTimeline.html">Timeline</a> that a <a href="xref:UnityEditor.Timeline.MarkerEditor">MarkerEditor</a> class should be associated to a given marker.</p>
<div class="fragment"><div class="line"> c#</div>
<div class="line">[CustomTimelineEditor(typeof(AnnotationMarker))]</div>
<div class="line">public class AnnotationMarkerEditor : MarkerEditor</div>
<div class="line">{</div>
<div class="line">   //...</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md5244"></a>
Marker information</h3>
<p><code>MarkerEditor</code> lets us provide information about the marker by overriding the <a href="xref:UnityEditor.Timeline.MarkerEditor#UnityEditor_Timeline_MarkerEditor_GetMarkerOptions_UnityEngine_Timeline_IMarker_">GetMarkerOptions</a> method.</p>
<div class="fragment"><div class="line"> c#</div>
<div class="line">public override MarkerDrawOptions GetMarkerOptions(IMarker marker)</div>
<div class="line">{</div>
<div class="line">   var annotation = marker as AnnotationMarker;</div>
<div class="line">   if (annotation != null)</div>
<div class="line">   {</div>
<div class="line">      return new MarkerDrawOptions { tooltip = annotation.title };</div>
<div class="line">   }</div>
<div class="line">   return base.GetMarkerOptions(marker);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Here the tooltip of an <code>Annotation</code> has been set to use the annotation's <code>title</code> variable.</p>
<p><img src="images/smpl_annotation_markerTooltip.png" alt="Marker tooltip" class="inline"/></p>
<p><a href="xref:UnityEditor.Timeline.MarkerDrawOptions">MarkerDrawOptions</a> can also set the error text on a marker, which can be useful if a variable has been incorrectly set and needs attention.</p>
<h3><a class="anchor" id="autotoc_md5245"></a>
Overlay</h3>
<p>An overlay can be drawn on top of a marker by overriding the <a href="xref:UnityEditor.Timeline.MarkerEditor#UnityEditor_Timeline_MarkerEditor_DrawOverlay_UnityEngine_Timeline_IMarker_UnityEditor_Timeline_MarkerUIStates_UnityEditor_Timeline_MarkerOverlayRegion_">DrawOverlay</a> method:</p>
<div class="fragment"><div class="line"> c#</div>
<div class="line">public override void DrawOverlay(IMarker marker, MarkerUIStates uiState, MarkerOverlayRegion region)</div>
<div class="line">{</div>
<div class="line">    var annotation = marker as AnnotationMarker;</div>
<div class="line">    if (annotation != null)</div>
<div class="line">    {</div>
<div class="line">        //Draw overlay code...</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>An overlay is drawn on top of the marker; the <a class="el" href="md_ConstructionSite_2Library_2PackageCache_2com_8unity_8timeline_0d1_87_86_2Documentation_0i_2uss__styles.html">USS style</a> is drawn first and <code>DrawOverlay</code> is called afterwards. For an <code>Annotation</code>, we can use <code>DrawOverlay</code> to change the color of the marker and to draw a line that spans the full <a class="el" href="namespaceTimeline.html">Timeline</a> window's height. To do this, we can use the information given in <code>region</code>. Along with the visible time range, <a href="xref:UnityEditor.Timeline.MarkerOverlayRegion">MarkerOverlayRegion</a> provides two rectangles that can be used to know where to draw:</p>
<ul>
<li><code>markerRegion</code></li>
</ul>
<p><code>markerRegion</code> is the rectangle that encompasses the marker. This is useful to draw something directly on the marker itself. For <code>Annotation</code>, this rectangle is used to draw the color overlay.</p>
<p><img src="images/smpl_annotation_markerOverlayRegion.png" alt="marker region" class="inline"/></p>
<ul>
<li><code>timelineRegion</code></li>
</ul>
<p><code>timelineRegion</code> is the rectangle that encompasses the clips and markers region of the timeline window. This is useful to draw something out of the marker's region, like the <code>Annotation</code>'s line overlay.</p>
<p><img src="images/smpl_annotation_timelineOverlayRegion.png" alt="timeline region" class="inline"/></p>
<div class="fragment"><div class="line"> c#</div>
<div class="line">const float k_LineOverlayWidth = 6.0f;</div>
<div class="line">float markerRegionCenter = markerRegion.xMin + (markerRegion.width - k_LineOverlayWidth) / 2.0f;</div>
<div class="line">Rect lineRect = new Rect(markerRegionCenter,</div>
<div class="line">    timelineRegion.y,</div>
<div class="line">    k_LineOverlayWidth,</div>
<div class="line">    timelineRegion.height);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md5246"></a>
3. Create custom Actions</h1>
<h2><a class="anchor" id="autotoc_md5247"></a>
Timeline Action</h2>
<p>Actions can be used to add new menu entries in <a class="el" href="namespaceTimeline.html">Timeline</a>'s context menus. For an Annotation, we want to add a menu item available in all context menus to create an <code>Annotation</code> with the clipboard's contents. To do this, a <a href="xref:UnityEditor.Timeline.Actions.TimelineAction">TimelineAction</a> is needed, along with the <a href="xref:UnityEditor.Timeline.Actions.MenuEntryAttribute">MenuEntry attribute</a>.</p>
<div class="fragment"><div class="line"> c#</div>
<div class="line">[MenuEntry(&quot;Create Annotation from clipboard contents&quot;)]</div>
<div class="line">public class CreateAnnotationFromClipboardContents : TimelineAction</div>
<div class="line">{</div>
<div class="line">    //...</div>
<div class="line">}</div>
</div><!-- fragment --><p><code>MenuEntry</code> lets <a class="el" href="namespaceTimeline.html">Timeline</a> know that this action can be added in context menus. Classes inheriting from <code>TimelineAction</code> need to override two methods: <code>Execute</code> and <code>Validate</code>.</p>
<h3><a class="anchor" id="autotoc_md5248"></a>
Validate</h3>
<p><code>Validate</code> is used to specify that the action's prerequisites are fulfilled. In the case of <code>CreateAnnotationFromClipboardContents</code>, the action is only valid if there actually is contents in the clipboard. <code>ActionValidity</code> is used to describe the validity state of an action:</p>
<div class="fragment"><div class="line"> c#</div>
<div class="line">public override ActionValidity Validate(ActionContext context)</div>
<div class="line">{</div>
<div class="line">    if (!markers.All(marker =&gt; marker is AnnotationMarker))</div>
<div class="line">        return ActionValidity.NotApplicable;</div>
<div class="line"> </div>
<div class="line">    string buffer = EditorGUIUtility.systemCopyBuffer;</div>
<div class="line">    return buffer.Length == 0 ?  ActionValidity.Invalid : ActionValidity.Valid;</div>
<div class="line">}</div>
</div><!-- fragment --><ul>
<li><code>ActionValidity.Valid</code> : The action can be executed.</li>
<li><code>ActionValidity.Invalid</code> : The action cannot be executed given the current context and will appear grayed out in context menus.</li>
<li><code>ActionValidity.NotApplicable</code> : The action does not apply to the current context and will not show up in menus.</li>
</ul>
<h3><a class="anchor" id="autotoc_md5249"></a>
Execute</h3>
<p><code>Execute</code> should run the code necessary to execute the action's purpose.</p>
<div class="fragment"><div class="line"> c#</div>
<div class="line"> public override bool Execute(ActionContext context)</div>
<div class="line">{</div>
<div class="line">    string buffer = EditorGUIUtility.systemCopyBuffer;</div>
<div class="line">    TrackAsset track = context.tracks.FirstOrDefault();</div>
<div class="line"> </div>
<div class="line">    if (buffer.Length != 0)</div>
<div class="line">    {</div>
<div class="line">        // Create the new annotation and add it to the track</div>
<div class="line">        //...</div>
<div class="line">        return true;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    return false;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The return value should specify if the execution succeeded or not.</p>
<h2><a class="anchor" id="autotoc_md5250"></a>
Marker Action</h2>
<p>It is also possible to write custom actions that apply only to markers, instead of all <a class="el" href="namespaceTimeline.html">Timeline</a> items. This is the purpose of the <code>MarkerEditor</code> class. It works just like <code>TimelineAction</code>, except that action applies to a list of markers.</p>
<p>A shortcut can also be assigned to an action. A static method with the <code>TimelineShortcut</code> attribute is needed. <code>Invoker</code> can be used to easily execute a given action:</p>
<div class="fragment"><div class="line"> c#</div>
<div class="line">[TimelineShortcut(&quot;Replace annotation description with clipboard&quot;, KeyCode.G)]</div>
<div class="line">public static void InvokeAction()</div>
<div class="line">{</div>
<div class="line">    Invoker.InvokeWithSelectedMarkers&lt;ReplaceAnnotationDescriptionAction&gt;();</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md5251"></a>
Notes</h1>
<h1><a class="anchor" id="autotoc_md5252"></a>
Runtime considerations</h1>
<p><code>AnnotationMarker</code> is available at runtime; it can be queried using, for example, <code>TrackAsset.GetMarkers()</code>. However, <code>AnnotationMarkerEditor</code> and custom actions are not available at runtime, since it depends on classes that are not part of the runtime assembly. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
